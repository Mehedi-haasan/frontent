"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunk_N_E"] = self["webpackChunk_N_E"] || []).push([["node_modules_aws-amplify_ui-components_dist_esm-es5_amplify-chatbot_entry_js"],{

/***/ "./node_modules/@aws-amplify/ui-components/dist/esm-es5/amplify-chatbot.entry.js":
/*!***************************************************************************************!*\
  !*** ./node_modules/@aws-amplify/ui-components/dist/esm-es5/amplify-chatbot.entry.js ***!
  \***************************************************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   amplify_chatbot: function() { return /* binding */ AmplifyChatbot; }\n/* harmony export */ });\n/* harmony import */ var _index_83f2275b_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-83f2275b.js */ \"./node_modules/@aws-amplify/ui-components/dist/esm-es5/index-83f2275b.js\");\n/* harmony import */ var _aws_amplify_core__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @aws-amplify/core */ \"./node_modules/@aws-amplify/core/lib-esm/index.js\");\n/* harmony import */ var _Translations_108d469f_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Translations-108d469f.js */ \"./node_modules/@aws-amplify/ui-components/dist/esm-es5/Translations-108d469f.js\");\n/* harmony import */ var _constants_c8ecaa24_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./constants-c8ecaa24.js */ \"./node_modules/@aws-amplify/ui-components/dist/esm-es5/constants-c8ecaa24.js\");\n/* harmony import */ var _aws_amplify_interactions__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @aws-amplify/interactions */ \"./node_modules/@aws-amplify/interactions/lib-esm/index.js\");\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (undefined && undefined.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArrays = (undefined && undefined.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\n\n\n\n\n\n\n// AudioRecorder settings\nvar RECORDER_EXPORT_MIME_TYPE = 'application/octet-stream';\nvar DEFAULT_EXPORT_SAMPLE_RATE = 16000;\nvar FFT_SIZE = 2048; // window size in samples for Fast Fourier Transform (FFT)\nvar FFT_MAX_DECIBELS = -10; // maximum power value in the scaling range for the FFT analysis data\nvar FFT_MIN_DECIBELS = -90; // minimum power value in the scaling range for the FFT analysis data\nvar FFT_SMOOTHING_TIME_CONSTANT = 0.85; // averaging constant with the last analysis frame\n/**\n * Merges multiple buffers into one.\n */\nvar mergeBuffers = function (bufferArray, recLength) {\n    var result = new Float32Array(recLength);\n    var offset = 0;\n    for (var i = 0; i < bufferArray.length; i++) {\n        result.set(bufferArray[i], offset);\n        offset += bufferArray[i].length;\n    }\n    return result;\n};\n/**\n * Downsamples audio to desired export sample rate.\n */\nvar downsampleBuffer = function (buffer, recordSampleRate, exportSampleRate) {\n    if (exportSampleRate === recordSampleRate) {\n        return buffer;\n    }\n    var sampleRateRatio = recordSampleRate / exportSampleRate;\n    var newLength = Math.round(buffer.length / sampleRateRatio);\n    var result = new Float32Array(newLength);\n    var offsetResult = 0;\n    var offsetBuffer = 0;\n    while (offsetResult < result.length) {\n        var nextOffsetBuffer = Math.round((offsetResult + 1) * sampleRateRatio);\n        var accum = 0, count = 0;\n        for (var i = offsetBuffer; i < nextOffsetBuffer && i < buffer.length; i++) {\n            accum += buffer[i];\n            count++;\n        }\n        result[offsetResult] = accum / count;\n        offsetResult++;\n        offsetBuffer = nextOffsetBuffer;\n    }\n    return result;\n};\n/**\n * converts raw audio values to 16 bit pcm.\n */\nvar floatTo16BitPCM = function (output, offset, input) {\n    var byteOffset = offset;\n    for (var i = 0; i < input.length; i++, byteOffset += 2) {\n        var s = Math.max(-1, Math.min(1, input[i]));\n        output.setInt16(byteOffset, s < 0 ? s * 0x8000 : s * 0x7fff, true);\n    }\n};\n/**\n * Write given strings in big-endian order.\n */\nvar writeString = function (view, offset, string) {\n    for (var i = 0; i < string.length; i++) {\n        view.setUint8(offset + i, string.charCodeAt(i));\n    }\n};\n/**\n * Encodes raw pcm audio into a wav file.\n */\nvar encodeWAV = function (samples, exportSampleRate) {\n    /**\n     * WAV file consists of three parts: RIFF header, WAVE subchunk, and data subchunk. We precompute the size of them.\n     */\n    var audioSize = samples.length * 2; // We use 16-bit samples, so we have (2 * sampleLength) bytes.\n    var fmtSize = 24; // Byte size of the fmt subchunk: 24 bytes that the audio information that we'll set below.\n    var dataSize = 8 + audioSize; // Byte size of the data subchunk: raw sound data plus 8 bytes for the subchunk descriptions.\n    var totalByteSize = 12 + fmtSize + dataSize; // Byte size of the whole file, including the chunk header / descriptor.\n    // create DataView object to write byte values into\n    var buffer = new ArrayBuffer(totalByteSize); // buffer to write the chunk values in.\n    var view = new DataView(buffer);\n    /**\n     * Start writing the .wav file. We write top to bottom, so byte offset (first numeric argument) increases strictly.\n     */\n    // RIFF header\n    writeString(view, 0, 'RIFF'); // At offset 0, write the letters \"RIFF\"\n    view.setUint32(4, fmtSize + dataSize, true); // At offset 4, write the size of fmt and data chunk size combined.\n    writeString(view, 8, 'WAVE'); // At offset 8, write the format type \"WAVE\"\n    // fmt subchunk\n    writeString(view, 12, 'fmt '); //chunkdId 'fmt '\n    view.setUint32(16, fmtSize - 8, true); // fmt subchunk size below this value. We set 8 bytes already, so subtract 8 bytes from fmtSize.\n    view.setUint16(20, 1, true); // Audio format code, which is 1 for PCM.\n    view.setUint16(22, 1, true); // Number of audio channels. We use mono, ie 1.\n    view.setUint32(24, exportSampleRate, true); // Sample rate of the audio file.\n    view.setUint32(28, exportSampleRate * 2, true); // Data rate, or # of data bytes per second. Since each sample is 2 bytes, this is 2 * sampleRate.\n    view.setUint16(32, 2, true); // block align, # of bytes per sample including all channels, ie. 2 bytes.\n    view.setUint16(34, 16, true); // bits per sample, ie. 16 bits\n    // data subchunk\n    writeString(view, 36, 'data'); // write the chunkId 'data'\n    view.setUint32(40, audioSize, true); // Audio byte size\n    floatTo16BitPCM(view, 44, samples); // raw pcm values then go here.\n    return view;\n};\n/**\n * Given arrays of raw pcm audio, downsamples the audio to desired sample rate and encodes it to a wav audio file.\n *\n * @param recBuffer {Float32Array[]} - 2d float array containing the recorded raw audio\n * @param recLength {number} - total length of recorded audio\n * @param recordSampleRate {number} - sample rate of the recorded audio\n * @param exportSampleRate {number} - desired sample rate of the exported file\n */\nvar exportBuffer = function (recBuffer, recLength, recordSampleRate, exportSampleRate) {\n    var mergedBuffers = mergeBuffers(recBuffer, recLength);\n    var downsampledBuffer = downsampleBuffer(mergedBuffers, recordSampleRate, exportSampleRate);\n    var encodedWav = encodeWAV(downsampledBuffer, exportSampleRate);\n    var audioBlob = new Blob([encodedWav], {\n        type: RECORDER_EXPORT_MIME_TYPE,\n    });\n    return audioBlob;\n};\nvar logger = new _aws_amplify_core__WEBPACK_IMPORTED_MODULE_3__.Logger('AudioRecorder');\nvar AudioRecorder = /** @class */ (function () {\n    function AudioRecorder(options) {\n        // input mic stream is stored in a buffer\n        this.streamBuffer = [];\n        this.streamBufferLength = 0;\n        this.recording = false;\n        this.options = options;\n    }\n    /**\n     * This must be called first to enable audio context and request microphone access.\n     * Once access granted, it connects all the necessary audio nodes to the context so that it can begin recording or playing.\n     */\n    AudioRecorder.prototype.init = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(0,_aws_amplify_core__WEBPACK_IMPORTED_MODULE_3__.browserOrNode)().isBrowser) return [3 /*break*/, 2];\n                        window.AudioContext =\n                            window.AudioContext || window.webkitAudioContext;\n                        this.audioContext = new AudioContext();\n                        return [4 /*yield*/, navigator.mediaDevices\n                                .getUserMedia({ audio: true })\n                                .then(function (stream) {\n                                _this.audioSupported = true;\n                                _this.setupAudioNodes(stream);\n                            })\n                                .catch(function () {\n                                _this.audioSupported = false;\n                                return Promise.reject('Audio is not supported');\n                            })];\n                    case 1:\n                        _a.sent();\n                        return [3 /*break*/, 3];\n                    case 2:\n                        this.audioSupported = false;\n                        return [2 /*return*/, Promise.reject('Audio is not supported')];\n                    case 3: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * Setup audio nodes after successful `init`.\n     */\n    AudioRecorder.prototype.setupAudioNodes = function (stream) {\n        return __awaiter(this, void 0, void 0, function () {\n            var err_1, sourceNode, processorNode, analyserNode;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 2, , 3]);\n                        return [4 /*yield*/, this.audioContext.resume()];\n                    case 1:\n                        _a.sent();\n                        return [3 /*break*/, 3];\n                    case 2:\n                        err_1 = _a.sent();\n                        logger.error(err_1);\n                        return [3 /*break*/, 3];\n                    case 3:\n                        sourceNode = this.audioContext.createMediaStreamSource(stream);\n                        processorNode = this.audioContext.createScriptProcessor(4096, 1, 1);\n                        processorNode.onaudioprocess = function (audioProcessingEvent) {\n                            if (!_this.recording)\n                                return;\n                            var stream = audioProcessingEvent.inputBuffer.getChannelData(0);\n                            _this.streamBuffer.push(new Float32Array(stream)); // set to a copy of the stream\n                            _this.streamBufferLength += stream.length;\n                            _this.analyse();\n                        };\n                        analyserNode = this.audioContext.createAnalyser();\n                        analyserNode.minDecibels = FFT_MIN_DECIBELS;\n                        analyserNode.maxDecibels = FFT_MAX_DECIBELS;\n                        analyserNode.smoothingTimeConstant = FFT_SMOOTHING_TIME_CONSTANT;\n                        sourceNode.connect(analyserNode);\n                        analyserNode.connect(processorNode);\n                        processorNode.connect(sourceNode.context.destination);\n                        this.analyserNode = analyserNode;\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * Start recording audio and listen for silence.\n     *\n     * @param onSilence {SilenceHandler} - called whenever silence is detected\n     * @param visualizer {Visualizer} - called with audio data on each audio process to be used for visualization.\n     */\n    AudioRecorder.prototype.startRecording = function (onSilence, visualizer) {\n        return __awaiter(this, void 0, void 0, function () {\n            var context, err_2;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (this.recording || !this.audioSupported)\n                            return [2 /*return*/];\n                        this.onSilence = onSilence || function () { };\n                        this.visualizer = visualizer || function () { };\n                        context = this.audioContext;\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, context.resume()];\n                    case 2:\n                        _a.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        err_2 = _a.sent();\n                        logger.error(err_2);\n                        return [3 /*break*/, 4];\n                    case 4:\n                        this.start = Date.now();\n                        this.recording = true;\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * Pause recording\n     */\n    AudioRecorder.prototype.stopRecording = function () {\n        if (!this.audioSupported)\n            return;\n        this.recording = false;\n    };\n    /**\n     * Pause recording and clear audio buffer\n     */\n    AudioRecorder.prototype.clear = function () {\n        this.stopRecording();\n        this.streamBufferLength = 0;\n        this.streamBuffer = [];\n    };\n    /**\n     * Plays given audioStream with audioContext\n     *\n     * @param buffer {Uint8Array} - audioStream to be played\n     */\n    AudioRecorder.prototype.play = function (buffer) {\n        var _this = this;\n        if (!buffer || !this.audioSupported)\n            return;\n        var myBlob = new Blob([buffer]);\n        return new Promise(function (res, rej) {\n            var fileReader = new FileReader();\n            fileReader.onload = function () {\n                if (_this.playbackSource)\n                    _this.playbackSource.disconnect(); // disconnect previous playback source\n                _this.playbackSource = _this.audioContext.createBufferSource();\n                var successCallback = function (buf) {\n                    _this.playbackSource.buffer = buf;\n                    _this.playbackSource.connect(_this.audioContext.destination);\n                    _this.playbackSource.onended = function () {\n                        return res();\n                    };\n                    _this.playbackSource.start(0);\n                };\n                var errorCallback = function (err) {\n                    return rej(err);\n                };\n                _this.audioContext.decodeAudioData(fileReader.result, successCallback, errorCallback);\n            };\n            fileReader.onerror = function () { return rej(); };\n            fileReader.readAsArrayBuffer(myBlob);\n        });\n    };\n    /**\n     * Stops playing audio if there's a playback source connected.\n     */\n    AudioRecorder.prototype.stop = function () {\n        if (this.playbackSource) {\n            this.playbackSource.stop();\n        }\n    };\n    /**\n     * Called after each audioProcess. Check for silence and give fft time domain data to visualizer.\n     */\n    AudioRecorder.prototype.analyse = function () {\n        if (!this.audioSupported)\n            return;\n        var analyser = this.analyserNode;\n        analyser.fftSize = FFT_SIZE;\n        var bufferLength = analyser.fftSize;\n        var dataArray = new Uint8Array(bufferLength);\n        var amplitude = this.options.amplitude;\n        var time = this.options.time;\n        analyser.getByteTimeDomainData(dataArray);\n        this.visualizer(dataArray, bufferLength);\n        for (var i = 0; i < bufferLength; i++) {\n            // Normalize between -1 and 1.\n            var curr_value_time = dataArray[i] / 128 - 1.0;\n            if (curr_value_time > amplitude || curr_value_time < -1 * amplitude) {\n                this.start = Date.now();\n            }\n        }\n        var newtime = Date.now();\n        var elapsedTime = newtime - this.start;\n        if (elapsedTime > time) {\n            this.onSilence();\n        }\n    };\n    /**\n     * Encodes recorded buffer to a wav file and exports it to a blob.\n     *\n     * @param exportSampleRate {number} - desired sample rate of the exported buffer\n     */\n    AudioRecorder.prototype.exportWAV = function (exportSampleRate) {\n        if (exportSampleRate === void 0) { exportSampleRate = DEFAULT_EXPORT_SAMPLE_RATE; }\n        return __awaiter(this, void 0, void 0, function () {\n            var recordSampleRate, blob;\n            return __generator(this, function (_a) {\n                if (!this.audioSupported)\n                    return [2 /*return*/];\n                recordSampleRate = this.audioContext.sampleRate;\n                blob = exportBuffer(this.streamBuffer, this.streamBufferLength, recordSampleRate, exportSampleRate);\n                this.clear();\n                return [2 /*return*/, blob];\n            });\n        });\n    };\n    return AudioRecorder;\n}());\nvar visualize = function (dataArray, bufferLength, canvas) {\n    if (!canvas)\n        return;\n    if (!(0,_aws_amplify_core__WEBPACK_IMPORTED_MODULE_3__.browserOrNode)().isBrowser)\n        throw new Error('Visualization is not supported on non-browsers.');\n    var _a = canvas.getBoundingClientRect(), width = _a.width, height = _a.height;\n    // need to update the default canvas width and height\n    canvas.width = width;\n    canvas.height = height;\n    var canvasCtx = canvas.getContext('2d');\n    canvasCtx.fillStyle = 'white';\n    canvasCtx.clearRect(0, 0, width, height);\n    var draw = function () {\n        canvasCtx.fillRect(0, 0, width, height);\n        canvasCtx.lineWidth = 1;\n        var color = getComputedStyle(document.documentElement).getPropertyValue('--amplify-primary-color');\n        canvasCtx.strokeStyle = !color || color === '' ? '#ff9900' : color; // TODO: try separate css variable\n        canvasCtx.beginPath();\n        var sliceWidth = (width * 1.0) / bufferLength;\n        var x = 0;\n        for (var i = 0; i < bufferLength || i % 3 === 0; i++) {\n            var value = dataArray[i] / 128.0;\n            var y = (value * height) / 2;\n            if (i === 0) {\n                canvasCtx.moveTo(x, y);\n            }\n            else {\n                canvasCtx.lineTo(x, y);\n            }\n            x += sliceWidth;\n        }\n        canvasCtx.lineTo(canvas.width, canvas.height / 2);\n        canvasCtx.stroke();\n    };\n    // Register our draw function with requestAnimationFrame.\n    requestAnimationFrame(draw);\n};\nvar amplifyChatbotCss = \".bot .dot{background-color:var(--bot-dot-color)}.user .dot{background-color:var(--user-dot-color)}.dot-flashing{width:2.625rem}.dot-flashing .dot{display:inline-block;width:0.625rem;height:0.625rem;border-radius:10rem;opacity:0.65}.dot-flashing .left{-webkit-animation:dot-flashing 1s infinite alternate;animation:dot-flashing 1s infinite alternate;-webkit-animation-delay:0s;animation-delay:0s}.dot-flashing .middle{margin-left:0.375rem;margin-right:0.375rem;-webkit-animation:dot-flashing 1s infinite linear alternate;animation:dot-flashing 1s infinite linear alternate;-webkit-animation-delay:0.5s;animation-delay:0.5s}.dot-flashing .right{-webkit-animation:dot-flashing 1s infinite alternate;animation:dot-flashing 1s infinite alternate;-webkit-animation-delay:1s;animation-delay:1s}@-webkit-keyframes dot-flashing{0%{opacity:0.65}50%,100%{opacity:0.1}}@keyframes dot-flashing{0%{opacity:0.65}50%,100%{opacity:0.1}}:host{--width:28.75rem;--height:37.5rem;--header-color:var(--amplify-secondary-color);--header-size:var(--amplify-text-lg);--bot-background-color:rgb(230, 230, 230);--bot-text-color:black;--bot-dot-color:var(--bot-text-color);--user-background-color:var(--amplify-blue);--user-text-color:var(--amplify-white);--user-dot-color:var(--user-text-color)}.amplify-chatbot{display:-ms-inline-flexbox;display:inline-flex;-ms-flex-direction:column;flex-direction:column;background-color:var(--background-color);border-radius:0.375rem;-webkit-box-shadow:0.0625rem 0rem 0.25rem 0 rgba(0, 0, 0, 0.15);box-shadow:0.0625rem 0rem 0.25rem 0 rgba(0, 0, 0, 0.15);-webkit-box-sizing:border-box;box-sizing:border-box;font-family:var(--amplify-font-family);margin-bottom:1rem;width:100%;height:var(--height);max-width:var(--width)}@media (min-width: 672px){.amplify-chatbot{width:var(--width)}}.header{padding:1.25rem 0.375rem 1.25rem 0.375rem;color:var(--header-color);font-size:var(--header-size);font-weight:bold;text-align:center;word-wrap:break-word}.body{border-top:0.0625rem solid rgba(0, 0, 0, 0.05);padding:1.5rem 1rem 0 1rem;display:-ms-flexbox;display:flex;-ms-flex-positive:1;flex-grow:1;-ms-flex-direction:column;flex-direction:column;overflow:auto}.bubble{max-width:100%;padding:0.8em 1.4em;text-align:left;word-wrap:break-word;margin-bottom:0.625rem}.bot{margin-right:auto;background-color:var(--bot-background-color);color:var(--bot-text-color);border-radius:1.5rem 1.5rem 1.5rem 0}.user{margin-left:auto;background-color:var(--user-background-color);color:var(--user-text-color);border-radius:1.5rem 1.5rem 0 1.5rem}.footer{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;border-top:0.062rem solid rgba(0, 0, 0, 0.05);padding-right:0.625rem;min-height:3.125rem}.footer amplify-input{--border:none;--margin:0;-ms-flex-positive:1;flex-grow:1}canvas{margin-left:0.625rem;margin-right:0.625rem;-ms-flex-positive:1;flex-grow:1;height:3.125rem}.icon-button{--icon-height:1.25rem;--icon-fill:var(--amplify-primary-color);--padding:0.625rem;--width:auto}\";\n// enum for possible bot states\nvar ChatState;\n(function (ChatState) {\n    ChatState[ChatState[\"Initial\"] = 0] = \"Initial\";\n    ChatState[ChatState[\"Listening\"] = 1] = \"Listening\";\n    ChatState[ChatState[\"SendingText\"] = 2] = \"SendingText\";\n    ChatState[ChatState[\"SendingVoice\"] = 3] = \"SendingVoice\";\n    ChatState[ChatState[\"Error\"] = 4] = \"Error\";\n})(ChatState || (ChatState = {}));\n// Message types\nvar MessageFrom;\n(function (MessageFrom) {\n    MessageFrom[\"Bot\"] = \"bot\";\n    MessageFrom[\"User\"] = \"user\";\n})(MessageFrom || (MessageFrom = {}));\n// Error types\nvar ChatErrorType;\n(function (ChatErrorType) {\n    ChatErrorType[ChatErrorType[\"Recoverable\"] = 0] = \"Recoverable\";\n    ChatErrorType[ChatErrorType[\"Unrecoverable\"] = 1] = \"Unrecoverable\";\n})(ChatErrorType || (ChatErrorType = {}));\nvar AmplifyChatbot = /** @class */ (function () {\n    function class_1(hostRef) {\n        var _this = this;\n        (0,_index_83f2275b_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);\n        /** Clear messages when conversation finishes */\n        this.clearOnComplete = false;\n        /** Continue listening to users after they send the message */\n        this.conversationModeOn = false;\n        /** Text placed in the top header */\n        this.botTitle = _Translations_108d469f_js__WEBPACK_IMPORTED_MODULE_1__.T.CHATBOT_TITLE;\n        /** Whether voice chat is enabled */\n        this.voiceEnabled = false;\n        /** Whether text chat is enabled */\n        this.textEnabled = true;\n        /** Amount of silence (in ms) to wait for */\n        this.silenceTime = 1500;\n        /** Noise threshold between -1 and 1. Anything below is considered a silence. */\n        this.silenceThreshold = 0.2;\n        /** Messages in current session */\n        this.messages = [];\n        /** Text input box value  */\n        this.text = '';\n        /** Current app state */\n        this.chatState = ChatState.Initial;\n        /**\n         * Rendering methods\n         */\n        this.messageJSX = function (messages) {\n            var messageList = messages.map(function (message) { return ((0,_index_83f2275b_js__WEBPACK_IMPORTED_MODULE_0__.h)(\"div\", { class: \"bubble \" + message.from }, message.content)); });\n            if (_this.chatState === ChatState.SendingText ||\n                _this.chatState === ChatState.SendingVoice) {\n                // if waiting for voice message, show animation on user side because app is waiting for transcript. Else put it on bot side.\n                var client = _this.chatState === ChatState.SendingText\n                    ? MessageFrom.Bot\n                    : MessageFrom.User;\n                messageList.push((0,_index_83f2275b_js__WEBPACK_IMPORTED_MODULE_0__.h)(\"div\", { class: \"bubble \" + client }, (0,_index_83f2275b_js__WEBPACK_IMPORTED_MODULE_0__.h)(\"div\", { class: \"dot-flashing \" + client }, (0,_index_83f2275b_js__WEBPACK_IMPORTED_MODULE_0__.h)(\"span\", { class: \"dot left\" }), (0,_index_83f2275b_js__WEBPACK_IMPORTED_MODULE_0__.h)(\"span\", { class: \"dot middle\" }), (0,_index_83f2275b_js__WEBPACK_IMPORTED_MODULE_0__.h)(\"span\", { class: \"dot right\" }))));\n            }\n            return messageList;\n        };\n        this.chatCompleted = (0,_index_83f2275b_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, \"chatCompleted\", 7);\n    }\n    // Occurs when user presses enter in input box\n    class_1.prototype.submitHandler = function (_event) {\n        this.sendTextMessage();\n    };\n    /**\n     * Lifecycle functions\n     */\n    class_1.prototype.componentWillLoad = function () {\n        if (!_aws_amplify_interactions__WEBPACK_IMPORTED_MODULE_4__.Interactions || typeof _aws_amplify_interactions__WEBPACK_IMPORTED_MODULE_4__.Interactions.onComplete !== 'function') {\n            throw new Error(_constants_c8ecaa24_js__WEBPACK_IMPORTED_MODULE_2__.c);\n        }\n        this.validateProps();\n    };\n    class_1.prototype.componentDidRender = function () {\n        // scroll to the bottom if necessary\n        var body = this.element.shadowRoot.querySelector('.body');\n        body.scrollTop = body.scrollHeight;\n    };\n    class_1.prototype.validateProps = function () {\n        var _this = this;\n        if (!this.voiceEnabled && !this.textEnabled) {\n            this.setError(_Translations_108d469f_js__WEBPACK_IMPORTED_MODULE_1__.T.CHAT_DISABLED_ERROR, ChatErrorType.Unrecoverable);\n            return;\n        }\n        else if (!this.botName) {\n            this.setError(_Translations_108d469f_js__WEBPACK_IMPORTED_MODULE_1__.T.NO_BOT_NAME_ERROR, ChatErrorType.Unrecoverable);\n            return;\n        }\n        if (this.welcomeMessage)\n            this.appendToChat(this.welcomeMessage, MessageFrom.Bot);\n        // Initialize AudioRecorder if voice is enabled\n        if (this.voiceEnabled) {\n            this.audioRecorder = new AudioRecorder({\n                time: this.silenceTime,\n                amplitude: this.silenceThreshold,\n            });\n            this.audioRecorder.init().catch(function (err) {\n                _this.setError(err, ChatErrorType.Recoverable);\n            });\n        }\n        // Callback function to be called after chat is completed\n        var onComplete = function (err, data) {\n            _this.chatCompleted.emit({\n                data: data,\n                err: err,\n            });\n            if (_this.clearOnComplete) {\n                _this.reset();\n            }\n            else {\n                _this.chatState = ChatState.Initial;\n            }\n        };\n        try {\n            _aws_amplify_interactions__WEBPACK_IMPORTED_MODULE_4__.Interactions.onComplete(this.botName, onComplete);\n        }\n        catch (err) {\n            this.setError(err, ChatErrorType.Unrecoverable);\n        }\n    };\n    /**\n     * Handlers\n     */\n    class_1.prototype.handleSubmit = function (event) {\n        event.preventDefault();\n        this.sendTextMessage();\n    };\n    class_1.prototype.handleMicButton = function () {\n        var _this = this;\n        if (this.chatState !== ChatState.Initial)\n            return;\n        this.audioRecorder.stop();\n        this.chatState = ChatState.Listening;\n        this.audioRecorder.startRecording(function () { return _this.handleSilence(); }, function (data, length) { return _this.visualizer(data, length); });\n    };\n    class_1.prototype.handleSilence = function () {\n        var _this = this;\n        this.chatState = ChatState.SendingVoice;\n        this.audioRecorder.stopRecording();\n        this.audioRecorder.exportWAV().then(function (blob) {\n            _this.sendVoiceMessage(blob);\n        });\n    };\n    class_1.prototype.handleTextChange = function (event) {\n        var target = event.target;\n        this.text = target.value;\n    };\n    class_1.prototype.handleCancelButton = function () {\n        this.audioRecorder.clear();\n        this.chatState = ChatState.Initial;\n    };\n    class_1.prototype.handleToastClose = function (errorType) {\n        this.error = undefined; // clear error\n        // if error is recoverable, reset the app state to initial\n        if (errorType === ChatErrorType.Recoverable) {\n            this.chatState = ChatState.Initial;\n        }\n    };\n    /**\n     * Visualization\n     */\n    class_1.prototype.visualizer = function (dataArray, bufferLength) {\n        var canvas = this.element.shadowRoot.querySelector('canvas');\n        visualize(dataArray, bufferLength, canvas);\n    };\n    /**\n     * Interactions helpers\n     */\n    class_1.prototype.sendTextMessage = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var text, response, err_3;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (this.text.length === 0 || this.chatState !== ChatState.Initial)\n                            return [2 /*return*/];\n                        text = this.text;\n                        this.text = '';\n                        this.appendToChat(text, MessageFrom.User);\n                        this.chatState = ChatState.SendingText;\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, _aws_amplify_interactions__WEBPACK_IMPORTED_MODULE_4__.Interactions.send(this.botName, text)];\n                    case 2:\n                        response = _a.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        err_3 = _a.sent();\n                        this.setError(err_3, ChatErrorType.Recoverable);\n                        return [2 /*return*/];\n                    case 4:\n                        if (response.message) {\n                            this.appendToChat(response.message, MessageFrom.Bot);\n                        }\n                        this.chatState = ChatState.Initial;\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    class_1.prototype.sendVoiceMessage = function (audioInput) {\n        return __awaiter(this, void 0, void 0, function () {\n            var interactionsMessage, response, err_4, dialogState;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        interactionsMessage = {\n                            content: audioInput,\n                            options: {\n                                messageType: 'voice',\n                            },\n                        };\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, _aws_amplify_interactions__WEBPACK_IMPORTED_MODULE_4__.Interactions.send(this.botName, interactionsMessage)];\n                    case 2:\n                        response = _a.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        err_4 = _a.sent();\n                        this.setError(err_4, ChatErrorType.Recoverable);\n                        return [2 /*return*/];\n                    case 4:\n                        this.chatState = ChatState.Initial;\n                        dialogState = response.dialogState;\n                        if (response.inputTranscript)\n                            this.appendToChat(response.inputTranscript, MessageFrom.User);\n                        this.appendToChat(response.message, MessageFrom.Bot);\n                        return [4 /*yield*/, this.audioRecorder\n                                .play(response.audioStream)\n                                .then(function () {\n                                // if conversationMode is on, chat is incomplete, and mic button isn't pressed yet, resume listening.\n                                if (_this.conversationModeOn &&\n                                    dialogState !== 'Fulfilled' &&\n                                    dialogState !== 'Failed' &&\n                                    _this.chatState === ChatState.Initial) {\n                                    _this.handleMicButton();\n                                }\n                            })\n                                .catch(function (err) { return _this.setError(err, ChatErrorType.Recoverable); })];\n                    case 5:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    class_1.prototype.appendToChat = function (content, from) {\n        this.messages = __spreadArrays(this.messages, [\n            {\n                content: content,\n                from: from,\n            },\n        ]);\n    };\n    /**\n     * State control methods\n     */\n    class_1.prototype.setError = function (error, errorType) {\n        var message = typeof error === 'string' ? error : error.message;\n        this.chatState = ChatState.Error;\n        this.error = { message: message, errorType: errorType };\n    };\n    class_1.prototype.reset = function () {\n        this.chatState = ChatState.Initial;\n        this.text = '';\n        this.error = undefined;\n        this.messages = [];\n        if (this.welcomeMessage)\n            this.appendToChat(this.welcomeMessage, MessageFrom.Bot);\n        this.audioRecorder && this.audioRecorder.clear();\n    };\n    class_1.prototype.listeningFooterJSX = function () {\n        var _this = this;\n        var visualization = (0,_index_83f2275b_js__WEBPACK_IMPORTED_MODULE_0__.h)(\"canvas\", { height: \"50\" });\n        var cancelButton = ((0,_index_83f2275b_js__WEBPACK_IMPORTED_MODULE_0__.h)(\"amplify-button\", { \"data-test\": \"chatbot-cancel-button\", handleButtonClick: function () { return _this.handleCancelButton(); }, class: \"icon-button\", variant: \"icon\", icon: \"ban\" }));\n        return [visualization, cancelButton];\n    };\n    class_1.prototype.footerJSX = function () {\n        var _this = this;\n        if (this.chatState === ChatState.Listening)\n            return this.listeningFooterJSX();\n        var inputPlaceholder = this.textEnabled\n            ? _Translations_108d469f_js__WEBPACK_IMPORTED_MODULE_1__.T.TEXT_INPUT_PLACEHOLDER\n            : _Translations_108d469f_js__WEBPACK_IMPORTED_MODULE_1__.T.VOICE_INPUT_PLACEHOLDER;\n        var textInput = ((0,_index_83f2275b_js__WEBPACK_IMPORTED_MODULE_0__.h)(\"amplify-input\", { placeholder: _aws_amplify_core__WEBPACK_IMPORTED_MODULE_3__.I18n.get(inputPlaceholder), description: \"text\", handleInputChange: function (evt) { return _this.handleTextChange(evt); }, value: this.text, disabled: this.chatState === ChatState.Error || !this.textEnabled }));\n        var micButton = this.voiceEnabled && ((0,_index_83f2275b_js__WEBPACK_IMPORTED_MODULE_0__.h)(\"amplify-button\", { \"data-test\": \"chatbot-mic-button\", handleButtonClick: function () { return _this.handleMicButton(); }, class: \"icon-button\", variant: \"icon\", icon: \"microphone\", disabled: this.chatState === ChatState.Error ||\n                this.chatState !== ChatState.Initial }));\n        var sendButton = this.textEnabled && ((0,_index_83f2275b_js__WEBPACK_IMPORTED_MODULE_0__.h)(\"amplify-button\", { \"data-test\": \"chatbot-send-button\", class: \"icon-button\", variant: \"icon\", icon: \"send\", handleButtonClick: function () { return _this.sendTextMessage(); }, disabled: this.chatState === ChatState.Error ||\n                this.chatState !== ChatState.Initial }));\n        return [textInput, micButton, sendButton];\n    };\n    class_1.prototype.errorToast = function () {\n        var _this = this;\n        if (!this.error)\n            return;\n        var _a = this.error, message = _a.message, errorType = _a.errorType;\n        return ((0,_index_83f2275b_js__WEBPACK_IMPORTED_MODULE_0__.h)(\"amplify-toast\", { message: _aws_amplify_core__WEBPACK_IMPORTED_MODULE_3__.I18n.get(message), handleClose: function () { return _this.handleToastClose(errorType); } }));\n    };\n    class_1.prototype.render = function () {\n        var _this = this;\n        return ((0,_index_83f2275b_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_83f2275b_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_83f2275b_js__WEBPACK_IMPORTED_MODULE_0__.h)(\"div\", { class: \"amplify-chatbot\" }, (0,_index_83f2275b_js__WEBPACK_IMPORTED_MODULE_0__.h)(\"slot\", { name: \"header\" }, (0,_index_83f2275b_js__WEBPACK_IMPORTED_MODULE_0__.h)(\"div\", { class: \"header\", \"data-test\": \"chatbot-header\" }, _aws_amplify_core__WEBPACK_IMPORTED_MODULE_3__.I18n.get(this.botTitle))), (0,_index_83f2275b_js__WEBPACK_IMPORTED_MODULE_0__.h)(\"div\", { class: \"body\", \"data-test\": \"chatbot-body\" }, this.messageJSX(this.messages)), (0,_index_83f2275b_js__WEBPACK_IMPORTED_MODULE_0__.h)(\"form\", { onSubmit: function (e) { return _this.handleSubmit(e); } }, (0,_index_83f2275b_js__WEBPACK_IMPORTED_MODULE_0__.h)(\"div\", { class: \"footer\", \"data-test\": \"chatbot-footer\" }, this.footerJSX())), this.errorToast())));\n    };\n    Object.defineProperty(class_1.prototype, \"element\", {\n        get: function () { return (0,_index_83f2275b_js__WEBPACK_IMPORTED_MODULE_0__.g)(this); },\n        enumerable: false,\n        configurable: true\n    });\n    return class_1;\n}());\nAmplifyChatbot.style = amplifyChatbotCss;\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvQGF3cy1hbXBsaWZ5L3VpLWNvbXBvbmVudHMvZGlzdC9lc20tZXM1L2FtcGxpZnktY2hhdGJvdC5lbnRyeS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQSxpQkFBaUIsU0FBSSxJQUFJLFNBQUk7QUFDN0IsNEJBQTRCLCtEQUErRCxpQkFBaUI7QUFDNUc7QUFDQSxvQ0FBb0MsTUFBTSwrQkFBK0IsWUFBWTtBQUNyRixtQ0FBbUMsTUFBTSxtQ0FBbUMsWUFBWTtBQUN4RixnQ0FBZ0M7QUFDaEM7QUFDQSxLQUFLO0FBQ0w7QUFDQSxtQkFBbUIsU0FBSSxJQUFJLFNBQUk7QUFDL0IsY0FBYyw2QkFBNkIsMEJBQTBCLGNBQWMscUJBQXFCO0FBQ3hHLGlCQUFpQixvREFBb0QscUVBQXFFLGNBQWM7QUFDeEosdUJBQXVCLHNCQUFzQjtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0M7QUFDeEMsbUNBQW1DLFNBQVM7QUFDNUMsbUNBQW1DLFdBQVcsVUFBVTtBQUN4RCwwQ0FBMEMsY0FBYztBQUN4RDtBQUNBLDhHQUE4RyxPQUFPO0FBQ3JILGlGQUFpRixpQkFBaUI7QUFDbEcseURBQXlELGdCQUFnQixRQUFRO0FBQ2pGLCtDQUErQyxnQkFBZ0IsZ0JBQWdCO0FBQy9FO0FBQ0Esa0NBQWtDO0FBQ2xDO0FBQ0E7QUFDQSxVQUFVLFlBQVksYUFBYSxTQUFTLFVBQVU7QUFDdEQsb0NBQW9DLFNBQVM7QUFDN0M7QUFDQTtBQUNBLHNCQUFzQixTQUFJLElBQUksU0FBSTtBQUNsQyxrREFBa0QsUUFBUTtBQUMxRCx5Q0FBeUMsUUFBUTtBQUNqRCx5REFBeUQsUUFBUTtBQUNqRTtBQUNBO0FBQ0E7QUFDNkc7QUFDN0M7QUFDckM7QUFDb0M7QUFDYTtBQUNuQjtBQUN6RDtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckIsNEJBQTRCO0FBQzVCLDRCQUE0QjtBQUM1Qix3Q0FBd0M7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFD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QkFBb0IsU0FBUyxtREFBSSwwQ0FBMEMsNkNBQTZDO0FBQ3pJO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixxREFBQyxDQUFDLGlEQUFJLFFBQVEscURBQUMsVUFBVSwwQkFBMEIsRUFBRSxxREFBQyxXQUFXLGdCQUFnQixFQUFFLHFEQUFDLFVBQVUsZ0RBQWdELEVBQUUsbURBQUksdUJBQXVCLHFEQUFDLFVBQVUsNENBQTRDLG1DQUFtQyxxREFBQyxXQUFXLHlCQUF5QixpQ0FBaUMsRUFBRSxxREFBQyxVQUFVLGdEQUFnRDtBQUN4WjtBQUNBO0FBQ0EsMkJBQTJCLE9BQU8scURBQVUsU0FBUztBQUNyRDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsQ0FBQztBQUNEO0FBQzZDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vX05fRS8uL25vZGVfbW9kdWxlcy9AYXdzLWFtcGxpZnkvdWktY29tcG9uZW50cy9kaXN0L2VzbS1lczUvYW1wbGlmeS1jaGF0Ym90LmVudHJ5LmpzPzIwMDUiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19nZW5lcmF0b3IgPSAodGhpcyAmJiB0aGlzLl9fZ2VuZXJhdG9yKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgYm9keSkge1xuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7XG4gICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksIFwidGhyb3dcIjogdmVyYigxKSwgXCJyZXR1cm5cIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XG4gICAgICAgIHdoaWxlIChfKSB0cnkge1xuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XG4gICAgfVxufTtcbnZhciBfX3NwcmVhZEFycmF5cyA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheXMpIHx8IGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcbiAgICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxuICAgICAgICAgICAgcltrXSA9IGFbal07XG4gICAgcmV0dXJuIHI7XG59O1xuaW1wb3J0IHsgciBhcyByZWdpc3Rlckluc3RhbmNlLCBoLCBjIGFzIGNyZWF0ZUV2ZW50LCBIIGFzIEhvc3QsIGcgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtODNmMjI3NWIuanMnO1xuaW1wb3J0IHsgTG9nZ2VyLCBicm93c2VyT3JOb2RlLCBJMThuIH0gZnJvbSAnQGF3cy1hbXBsaWZ5L2NvcmUnO1xuaW1wb3J0ICdAYXdzLWFtcGxpZnkvYXV0aCc7XG5pbXBvcnQgeyBUIGFzIFRyYW5zbGF0aW9ucyB9IGZyb20gJy4vVHJhbnNsYXRpb25zLTEwOGQ0NjlmLmpzJztcbmltcG9ydCB7IGMgYXMgTk9fSU5URVJBQ1RJT05TX01PRFVMRV9GT1VORCB9IGZyb20gJy4vY29uc3RhbnRzLWM4ZWNhYTI0LmpzJztcbmltcG9ydCB7IEludGVyYWN0aW9ucyB9IGZyb20gJ0Bhd3MtYW1wbGlmeS9pbnRlcmFjdGlvbnMnO1xuLy8gQXVkaW9SZWNvcmRlciBzZXR0aW5nc1xudmFyIFJFQ09SREVSX0VYUE9SVF9NSU1FX1RZUEUgPSAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJztcbnZhciBERUZBVUxUX0VYUE9SVF9TQU1QTEVfUkFURSA9IDE2MDAwO1xudmFyIEZGVF9TSVpFID0gMjA0ODsgLy8gd2luZG93IHNpemUgaW4gc2FtcGxlcyBmb3IgRmFzdCBGb3VyaWVyIFRyYW5zZm9ybSAoRkZUKVxudmFyIEZGVF9NQVhfREVDSUJFTFMgPSAtMTA7IC8vIG1heGltdW0gcG93ZXIgdmFsdWUgaW4gdGhlIHNjYWxpbmcgcmFuZ2UgZm9yIHRoZSBGRlQgYW5hbHlzaXMgZGF0YVxudmFyIEZGVF9NSU5fREVDSUJFTFMgPSAtOTA7IC8vIG1pbmltdW0gcG93ZXIgdmFsdWUgaW4gdGhlIHNjYWxpbmcgcmFuZ2UgZm9yIHRoZSBGRlQgYW5hbHlzaXMgZGF0YVxudmFyIEZGVF9TTU9PVEhJTkdfVElNRV9DT05TVEFOVCA9IDAuODU7IC8vIGF2ZXJhZ2luZyBjb25zdGFudCB3aXRoIHRoZSBsYXN0IGFuYWx5c2lzIGZyYW1lXG4vKipcbiAqIE1lcmdlcyBtdWx0aXBsZSBidWZmZXJzIGludG8gb25lLlxuICovXG52YXIgbWVyZ2VCdWZmZXJzID0gZnVuY3Rpb24gKGJ1ZmZlckFycmF5LCByZWNMZW5ndGgpIHtcbiAgICB2YXIgcmVzdWx0ID0gbmV3IEZsb2F0MzJBcnJheShyZWNMZW5ndGgpO1xuICAgIHZhciBvZmZzZXQgPSAwO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYnVmZmVyQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgcmVzdWx0LnNldChidWZmZXJBcnJheVtpXSwgb2Zmc2V0KTtcbiAgICAgICAgb2Zmc2V0ICs9IGJ1ZmZlckFycmF5W2ldLmxlbmd0aDtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG4vKipcbiAqIERvd25zYW1wbGVzIGF1ZGlvIHRvIGRlc2lyZWQgZXhwb3J0IHNhbXBsZSByYXRlLlxuICovXG52YXIgZG93bnNhbXBsZUJ1ZmZlciA9IGZ1bmN0aW9uIChidWZmZXIsIHJlY29yZFNhbXBsZVJhdGUsIGV4cG9ydFNhbXBsZVJhdGUpIHtcbiAgICBpZiAoZXhwb3J0U2FtcGxlUmF0ZSA9PT0gcmVjb3JkU2FtcGxlUmF0ZSkge1xuICAgICAgICByZXR1cm4gYnVmZmVyO1xuICAgIH1cbiAgICB2YXIgc2FtcGxlUmF0ZVJhdGlvID0gcmVjb3JkU2FtcGxlUmF0ZSAvIGV4cG9ydFNhbXBsZVJhdGU7XG4gICAgdmFyIG5ld0xlbmd0aCA9IE1hdGgucm91bmQoYnVmZmVyLmxlbmd0aCAvIHNhbXBsZVJhdGVSYXRpbyk7XG4gICAgdmFyIHJlc3VsdCA9IG5ldyBGbG9hdDMyQXJyYXkobmV3TGVuZ3RoKTtcbiAgICB2YXIgb2Zmc2V0UmVzdWx0ID0gMDtcbiAgICB2YXIgb2Zmc2V0QnVmZmVyID0gMDtcbiAgICB3aGlsZSAob2Zmc2V0UmVzdWx0IDwgcmVzdWx0Lmxlbmd0aCkge1xuICAgICAgICB2YXIgbmV4dE9mZnNldEJ1ZmZlciA9IE1hdGgucm91bmQoKG9mZnNldFJlc3VsdCArIDEpICogc2FtcGxlUmF0ZVJhdGlvKTtcbiAgICAgICAgdmFyIGFjY3VtID0gMCwgY291bnQgPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gb2Zmc2V0QnVmZmVyOyBpIDwgbmV4dE9mZnNldEJ1ZmZlciAmJiBpIDwgYnVmZmVyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBhY2N1bSArPSBidWZmZXJbaV07XG4gICAgICAgICAgICBjb3VudCsrO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdFtvZmZzZXRSZXN1bHRdID0gYWNjdW0gLyBjb3VudDtcbiAgICAgICAgb2Zmc2V0UmVzdWx0Kys7XG4gICAgICAgIG9mZnNldEJ1ZmZlciA9IG5leHRPZmZzZXRCdWZmZXI7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59O1xuLyoqXG4gKiBjb252ZXJ0cyByYXcgYXVkaW8gdmFsdWVzIHRvIDE2IGJpdCBwY20uXG4gKi9cbnZhciBmbG9hdFRvMTZCaXRQQ00gPSBmdW5jdGlvbiAob3V0cHV0LCBvZmZzZXQsIGlucHV0KSB7XG4gICAgdmFyIGJ5dGVPZmZzZXQgPSBvZmZzZXQ7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbnB1dC5sZW5ndGg7IGkrKywgYnl0ZU9mZnNldCArPSAyKSB7XG4gICAgICAgIHZhciBzID0gTWF0aC5tYXgoLTEsIE1hdGgubWluKDEsIGlucHV0W2ldKSk7XG4gICAgICAgIG91dHB1dC5zZXRJbnQxNihieXRlT2Zmc2V0LCBzIDwgMCA/IHMgKiAweDgwMDAgOiBzICogMHg3ZmZmLCB0cnVlKTtcbiAgICB9XG59O1xuLyoqXG4gKiBXcml0ZSBnaXZlbiBzdHJpbmdzIGluIGJpZy1lbmRpYW4gb3JkZXIuXG4gKi9cbnZhciB3cml0ZVN0cmluZyA9IGZ1bmN0aW9uICh2aWV3LCBvZmZzZXQsIHN0cmluZykge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyaW5nLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZpZXcuc2V0VWludDgob2Zmc2V0ICsgaSwgc3RyaW5nLmNoYXJDb2RlQXQoaSkpO1xuICAgIH1cbn07XG4vKipcbiAqIEVuY29kZXMgcmF3IHBjbSBhdWRpbyBpbnRvIGEgd2F2IGZpbGUuXG4gKi9cbnZhciBlbmNvZGVXQVYgPSBmdW5jdGlvbiAoc2FtcGxlcywgZXhwb3J0U2FtcGxlUmF0ZSkge1xuICAgIC8qKlxuICAgICAqIFdBViBmaWxlIGNvbnNpc3RzIG9mIHRocmVlIHBhcnRzOiBSSUZGIGhlYWRlciwgV0FWRSBzdWJjaHVuaywgYW5kIGRhdGEgc3ViY2h1bmsuIFdlIHByZWNvbXB1dGUgdGhlIHNpemUgb2YgdGhlbS5cbiAgICAgKi9cbiAgICB2YXIgYXVkaW9TaXplID0gc2FtcGxlcy5sZW5ndGggKiAyOyAvLyBXZSB1c2UgMTYtYml0IHNhbXBsZXMsIHNvIHdlIGhhdmUgKDIgKiBzYW1wbGVMZW5ndGgpIGJ5dGVzLlxuICAgIHZhciBmbXRTaXplID0gMjQ7IC8vIEJ5dGUgc2l6ZSBvZiB0aGUgZm10IHN1YmNodW5rOiAyNCBieXRlcyB0aGF0IHRoZSBhdWRpbyBpbmZvcm1hdGlvbiB0aGF0IHdlJ2xsIHNldCBiZWxvdy5cbiAgICB2YXIgZGF0YVNpemUgPSA4ICsgYXVkaW9TaXplOyAvLyBCeXRlIHNpemUgb2YgdGhlIGRhdGEgc3ViY2h1bms6IHJhdyBzb3VuZCBkYXRhIHBsdXMgOCBieXRlcyBmb3IgdGhlIHN1YmNodW5rIGRlc2NyaXB0aW9ucy5cbiAgICB2YXIgdG90YWxCeXRlU2l6ZSA9IDEyICsgZm10U2l6ZSArIGRhdGFTaXplOyAvLyBCeXRlIHNpemUgb2YgdGhlIHdob2xlIGZpbGUsIGluY2x1ZGluZyB0aGUgY2h1bmsgaGVhZGVyIC8gZGVzY3JpcHRvci5cbiAgICAvLyBjcmVhdGUgRGF0YVZpZXcgb2JqZWN0IHRvIHdyaXRlIGJ5dGUgdmFsdWVzIGludG9cbiAgICB2YXIgYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKHRvdGFsQnl0ZVNpemUpOyAvLyBidWZmZXIgdG8gd3JpdGUgdGhlIGNodW5rIHZhbHVlcyBpbi5cbiAgICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyhidWZmZXIpO1xuICAgIC8qKlxuICAgICAqIFN0YXJ0IHdyaXRpbmcgdGhlIC53YXYgZmlsZS4gV2Ugd3JpdGUgdG9wIHRvIGJvdHRvbSwgc28gYnl0ZSBvZmZzZXQgKGZpcnN0IG51bWVyaWMgYXJndW1lbnQpIGluY3JlYXNlcyBzdHJpY3RseS5cbiAgICAgKi9cbiAgICAvLyBSSUZGIGhlYWRlclxuICAgIHdyaXRlU3RyaW5nKHZpZXcsIDAsICdSSUZGJyk7IC8vIEF0IG9mZnNldCAwLCB3cml0ZSB0aGUgbGV0dGVycyBcIlJJRkZcIlxuICAgIHZpZXcuc2V0VWludDMyKDQsIGZtdFNpemUgKyBkYXRhU2l6ZSwgdHJ1ZSk7IC8vIEF0IG9mZnNldCA0LCB3cml0ZSB0aGUgc2l6ZSBvZiBmbXQgYW5kIGRhdGEgY2h1bmsgc2l6ZSBjb21iaW5lZC5cbiAgICB3cml0ZVN0cmluZyh2aWV3LCA4LCAnV0FWRScpOyAvLyBBdCBvZmZzZXQgOCwgd3JpdGUgdGhlIGZvcm1hdCB0eXBlIFwiV0FWRVwiXG4gICAgLy8gZm10IHN1YmNodW5rXG4gICAgd3JpdGVTdHJpbmcodmlldywgMTIsICdmbXQgJyk7IC8vY2h1bmtkSWQgJ2ZtdCAnXG4gICAgdmlldy5zZXRVaW50MzIoMTYsIGZtdFNpemUgLSA4LCB0cnVlKTsgLy8gZm10IHN1YmNodW5rIHNpemUgYmVsb3cgdGhpcyB2YWx1ZS4gV2Ugc2V0IDggYnl0ZXMgYWxyZWFkeSwgc28gc3VidHJhY3QgOCBieXRlcyBmcm9tIGZtdFNpemUuXG4gICAgdmlldy5zZXRVaW50MTYoMjAsIDEsIHRydWUpOyAvLyBBdWRpbyBmb3JtYXQgY29kZSwgd2hpY2ggaXMgMSBmb3IgUENNLlxuICAgIHZpZXcuc2V0VWludDE2KDIyLCAxLCB0cnVlKTsgLy8gTnVtYmVyIG9mIGF1ZGlvIGNoYW5uZWxzLiBXZSB1c2UgbW9ubywgaWUgMS5cbiAgICB2aWV3LnNldFVpbnQzMigyNCwgZXhwb3J0U2FtcGxlUmF0ZSwgdHJ1ZSk7IC8vIFNhbXBsZSByYXRlIG9mIHRoZSBhdWRpbyBmaWxlLlxuICAgIHZpZXcuc2V0VWludDMyKDI4LCBleHBvcnRTYW1wbGVSYXRlICogMiwgdHJ1ZSk7IC8vIERhdGEgcmF0ZSwgb3IgIyBvZiBkYXRhIGJ5dGVzIHBlciBzZWNvbmQuIFNpbmNlIGVhY2ggc2FtcGxlIGlzIDIgYnl0ZXMsIHRoaXMgaXMgMiAqIHNhbXBsZVJhdGUuXG4gICAgdmlldy5zZXRVaW50MTYoMzIsIDIsIHRydWUpOyAvLyBibG9jayBhbGlnbiwgIyBvZiBieXRlcyBwZXIgc2FtcGxlIGluY2x1ZGluZyBhbGwgY2hhbm5lbHMsIGllLiAyIGJ5dGVzLlxuICAgIHZpZXcuc2V0VWludDE2KDM0LCAxNiwgdHJ1ZSk7IC8vIGJpdHMgcGVyIHNhbXBsZSwgaWUuIDE2IGJpdHNcbiAgICAvLyBkYXRhIHN1YmNodW5rXG4gICAgd3JpdGVTdHJpbmcodmlldywgMzYsICdkYXRhJyk7IC8vIHdyaXRlIHRoZSBjaHVua0lkICdkYXRhJ1xuICAgIHZpZXcuc2V0VWludDMyKDQwLCBhdWRpb1NpemUsIHRydWUpOyAvLyBBdWRpbyBieXRlIHNpemVcbiAgICBmbG9hdFRvMTZCaXRQQ00odmlldywgNDQsIHNhbXBsZXMpOyAvLyByYXcgcGNtIHZhbHVlcyB0aGVuIGdvIGhlcmUuXG4gICAgcmV0dXJuIHZpZXc7XG59O1xuLyoqXG4gKiBHaXZlbiBhcnJheXMgb2YgcmF3IHBjbSBhdWRpbywgZG93bnNhbXBsZXMgdGhlIGF1ZGlvIHRvIGRlc2lyZWQgc2FtcGxlIHJhdGUgYW5kIGVuY29kZXMgaXQgdG8gYSB3YXYgYXVkaW8gZmlsZS5cbiAqXG4gKiBAcGFyYW0gcmVjQnVmZmVyIHtGbG9hdDMyQXJyYXlbXX0gLSAyZCBmbG9hdCBhcnJheSBjb250YWluaW5nIHRoZSByZWNvcmRlZCByYXcgYXVkaW9cbiAqIEBwYXJhbSByZWNMZW5ndGgge251bWJlcn0gLSB0b3RhbCBsZW5ndGggb2YgcmVjb3JkZWQgYXVkaW9cbiAqIEBwYXJhbSByZWNvcmRTYW1wbGVSYXRlIHtudW1iZXJ9IC0gc2FtcGxlIHJhdGUgb2YgdGhlIHJlY29yZGVkIGF1ZGlvXG4gKiBAcGFyYW0gZXhwb3J0U2FtcGxlUmF0ZSB7bnVtYmVyfSAtIGRlc2lyZWQgc2FtcGxlIHJhdGUgb2YgdGhlIGV4cG9ydGVkIGZpbGVcbiAqL1xudmFyIGV4cG9ydEJ1ZmZlciA9IGZ1bmN0aW9uIChyZWNCdWZmZXIsIHJlY0xlbmd0aCwgcmVjb3JkU2FtcGxlUmF0ZSwgZXhwb3J0U2FtcGxlUmF0ZSkge1xuICAgIHZhciBtZXJnZWRCdWZmZXJzID0gbWVyZ2VCdWZmZXJzKHJlY0J1ZmZlciwgcmVjTGVuZ3RoKTtcbiAgICB2YXIgZG93bnNhbXBsZWRCdWZmZXIgPSBkb3duc2FtcGxlQnVmZmVyKG1lcmdlZEJ1ZmZlcnMsIHJlY29yZFNhbXBsZVJhdGUsIGV4cG9ydFNhbXBsZVJhdGUpO1xuICAgIHZhciBlbmNvZGVkV2F2ID0gZW5jb2RlV0FWKGRvd25zYW1wbGVkQnVmZmVyLCBleHBvcnRTYW1wbGVSYXRlKTtcbiAgICB2YXIgYXVkaW9CbG9iID0gbmV3IEJsb2IoW2VuY29kZWRXYXZdLCB7XG4gICAgICAgIHR5cGU6IFJFQ09SREVSX0VYUE9SVF9NSU1FX1RZUEUsXG4gICAgfSk7XG4gICAgcmV0dXJuIGF1ZGlvQmxvYjtcbn07XG52YXIgbG9nZ2VyID0gbmV3IExvZ2dlcignQXVkaW9SZWNvcmRlcicpO1xudmFyIEF1ZGlvUmVjb3JkZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQXVkaW9SZWNvcmRlcihvcHRpb25zKSB7XG4gICAgICAgIC8vIGlucHV0IG1pYyBzdHJlYW0gaXMgc3RvcmVkIGluIGEgYnVmZmVyXG4gICAgICAgIHRoaXMuc3RyZWFtQnVmZmVyID0gW107XG4gICAgICAgIHRoaXMuc3RyZWFtQnVmZmVyTGVuZ3RoID0gMDtcbiAgICAgICAgdGhpcy5yZWNvcmRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhpcyBtdXN0IGJlIGNhbGxlZCBmaXJzdCB0byBlbmFibGUgYXVkaW8gY29udGV4dCBhbmQgcmVxdWVzdCBtaWNyb3Bob25lIGFjY2Vzcy5cbiAgICAgKiBPbmNlIGFjY2VzcyBncmFudGVkLCBpdCBjb25uZWN0cyBhbGwgdGhlIG5lY2Vzc2FyeSBhdWRpbyBub2RlcyB0byB0aGUgY29udGV4dCBzbyB0aGF0IGl0IGNhbiBiZWdpbiByZWNvcmRpbmcgb3IgcGxheWluZy5cbiAgICAgKi9cbiAgICBBdWRpb1JlY29yZGVyLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFicm93c2VyT3JOb2RlKCkuaXNCcm93c2VyKSByZXR1cm4gWzMgLypicmVhayovLCAyXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5BdWRpb0NvbnRleHQgPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5BdWRpb0NvbnRleHQgfHwgd2luZG93LndlYmtpdEF1ZGlvQ29udGV4dDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXVkaW9Db250ZXh0ID0gbmV3IEF1ZGlvQ29udGV4dCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgbmF2aWdhdG9yLm1lZGlhRGV2aWNlc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0VXNlck1lZGlhKHsgYXVkaW86IHRydWUgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHN0cmVhbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdWRpb1N1cHBvcnRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNldHVwQXVkaW9Ob2RlcyhzdHJlYW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF1ZGlvU3VwcG9ydGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgnQXVkaW8gaXMgbm90IHN1cHBvcnRlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgM107XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXVkaW9TdXBwb3J0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBQcm9taXNlLnJlamVjdCgnQXVkaW8gaXMgbm90IHN1cHBvcnRlZCcpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOiByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogU2V0dXAgYXVkaW8gbm9kZXMgYWZ0ZXIgc3VjY2Vzc2Z1bCBgaW5pdGAuXG4gICAgICovXG4gICAgQXVkaW9SZWNvcmRlci5wcm90b3R5cGUuc2V0dXBBdWRpb05vZGVzID0gZnVuY3Rpb24gKHN0cmVhbSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgZXJyXzEsIHNvdXJjZU5vZGUsIHByb2Nlc3Nvck5vZGUsIGFuYWx5c2VyTm9kZTtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS50cnlzLnB1c2goWzAsIDIsICwgM10pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5hdWRpb0NvbnRleHQucmVzdW1lKCldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCAzXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyXzEgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXJyXzEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgM107XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZU5vZGUgPSB0aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVNZWRpYVN0cmVhbVNvdXJjZShzdHJlYW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc29yTm9kZSA9IHRoaXMuYXVkaW9Db250ZXh0LmNyZWF0ZVNjcmlwdFByb2Nlc3Nvcig0MDk2LCAxLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3Nvck5vZGUub25hdWRpb3Byb2Nlc3MgPSBmdW5jdGlvbiAoYXVkaW9Qcm9jZXNzaW5nRXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIV90aGlzLnJlY29yZGluZylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdHJlYW0gPSBhdWRpb1Byb2Nlc3NpbmdFdmVudC5pbnB1dEJ1ZmZlci5nZXRDaGFubmVsRGF0YSgwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zdHJlYW1CdWZmZXIucHVzaChuZXcgRmxvYXQzMkFycmF5KHN0cmVhbSkpOyAvLyBzZXQgdG8gYSBjb3B5IG9mIHRoZSBzdHJlYW1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zdHJlYW1CdWZmZXJMZW5ndGggKz0gc3RyZWFtLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5hbmFseXNlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgYW5hbHlzZXJOb2RlID0gdGhpcy5hdWRpb0NvbnRleHQuY3JlYXRlQW5hbHlzZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuYWx5c2VyTm9kZS5taW5EZWNpYmVscyA9IEZGVF9NSU5fREVDSUJFTFM7XG4gICAgICAgICAgICAgICAgICAgICAgICBhbmFseXNlck5vZGUubWF4RGVjaWJlbHMgPSBGRlRfTUFYX0RFQ0lCRUxTO1xuICAgICAgICAgICAgICAgICAgICAgICAgYW5hbHlzZXJOb2RlLnNtb290aGluZ1RpbWVDb25zdGFudCA9IEZGVF9TTU9PVEhJTkdfVElNRV9DT05TVEFOVDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZU5vZGUuY29ubmVjdChhbmFseXNlck5vZGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYW5hbHlzZXJOb2RlLmNvbm5lY3QocHJvY2Vzc29yTm9kZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzb3JOb2RlLmNvbm5lY3Qoc291cmNlTm9kZS5jb250ZXh0LmRlc3RpbmF0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYW5hbHlzZXJOb2RlID0gYW5hbHlzZXJOb2RlO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFN0YXJ0IHJlY29yZGluZyBhdWRpbyBhbmQgbGlzdGVuIGZvciBzaWxlbmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIG9uU2lsZW5jZSB7U2lsZW5jZUhhbmRsZXJ9IC0gY2FsbGVkIHdoZW5ldmVyIHNpbGVuY2UgaXMgZGV0ZWN0ZWRcbiAgICAgKiBAcGFyYW0gdmlzdWFsaXplciB7VmlzdWFsaXplcn0gLSBjYWxsZWQgd2l0aCBhdWRpbyBkYXRhIG9uIGVhY2ggYXVkaW8gcHJvY2VzcyB0byBiZSB1c2VkIGZvciB2aXN1YWxpemF0aW9uLlxuICAgICAqL1xuICAgIEF1ZGlvUmVjb3JkZXIucHJvdG90eXBlLnN0YXJ0UmVjb3JkaW5nID0gZnVuY3Rpb24gKG9uU2lsZW5jZSwgdmlzdWFsaXplcikge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgY29udGV4dCwgZXJyXzI7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5yZWNvcmRpbmcgfHwgIXRoaXMuYXVkaW9TdXBwb3J0ZWQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vblNpbGVuY2UgPSBvblNpbGVuY2UgfHwgZnVuY3Rpb24gKCkgeyB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52aXN1YWxpemVyID0gdmlzdWFsaXplciB8fCBmdW5jdGlvbiAoKSB7IH07XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0ID0gdGhpcy5hdWRpb0NvbnRleHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5sYWJlbCA9IDE7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnRyeXMucHVzaChbMSwgMywgLCA0XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBjb250ZXh0LnJlc3VtZSgpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgNF07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycl8yID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycl8yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDRdO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVjb3JkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBQYXVzZSByZWNvcmRpbmdcbiAgICAgKi9cbiAgICBBdWRpb1JlY29yZGVyLnByb3RvdHlwZS5zdG9wUmVjb3JkaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXRoaXMuYXVkaW9TdXBwb3J0ZWQpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRoaXMucmVjb3JkaW5nID0gZmFsc2U7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBQYXVzZSByZWNvcmRpbmcgYW5kIGNsZWFyIGF1ZGlvIGJ1ZmZlclxuICAgICAqL1xuICAgIEF1ZGlvUmVjb3JkZXIucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnN0b3BSZWNvcmRpbmcoKTtcbiAgICAgICAgdGhpcy5zdHJlYW1CdWZmZXJMZW5ndGggPSAwO1xuICAgICAgICB0aGlzLnN0cmVhbUJ1ZmZlciA9IFtdO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogUGxheXMgZ2l2ZW4gYXVkaW9TdHJlYW0gd2l0aCBhdWRpb0NvbnRleHRcbiAgICAgKlxuICAgICAqIEBwYXJhbSBidWZmZXIge1VpbnQ4QXJyYXl9IC0gYXVkaW9TdHJlYW0gdG8gYmUgcGxheWVkXG4gICAgICovXG4gICAgQXVkaW9SZWNvcmRlci5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uIChidWZmZXIpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgaWYgKCFidWZmZXIgfHwgIXRoaXMuYXVkaW9TdXBwb3J0ZWQpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHZhciBteUJsb2IgPSBuZXcgQmxvYihbYnVmZmVyXSk7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzLCByZWopIHtcbiAgICAgICAgICAgIHZhciBmaWxlUmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgICAgICAgIGZpbGVSZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5wbGF5YmFja1NvdXJjZSlcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMucGxheWJhY2tTb3VyY2UuZGlzY29ubmVjdCgpOyAvLyBkaXNjb25uZWN0IHByZXZpb3VzIHBsYXliYWNrIHNvdXJjZVxuICAgICAgICAgICAgICAgIF90aGlzLnBsYXliYWNrU291cmNlID0gX3RoaXMuYXVkaW9Db250ZXh0LmNyZWF0ZUJ1ZmZlclNvdXJjZSgpO1xuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzQ2FsbGJhY2sgPSBmdW5jdGlvbiAoYnVmKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnBsYXliYWNrU291cmNlLmJ1ZmZlciA9IGJ1ZjtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMucGxheWJhY2tTb3VyY2UuY29ubmVjdChfdGhpcy5hdWRpb0NvbnRleHQuZGVzdGluYXRpb24pO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5wbGF5YmFja1NvdXJjZS5vbmVuZGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcygpO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5wbGF5YmFja1NvdXJjZS5zdGFydCgwKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHZhciBlcnJvckNhbGxiYWNrID0gZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVqKGVycik7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBfdGhpcy5hdWRpb0NvbnRleHQuZGVjb2RlQXVkaW9EYXRhKGZpbGVSZWFkZXIucmVzdWx0LCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGZpbGVSZWFkZXIub25lcnJvciA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlaigpOyB9O1xuICAgICAgICAgICAgZmlsZVJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihteUJsb2IpO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFN0b3BzIHBsYXlpbmcgYXVkaW8gaWYgdGhlcmUncyBhIHBsYXliYWNrIHNvdXJjZSBjb25uZWN0ZWQuXG4gICAgICovXG4gICAgQXVkaW9SZWNvcmRlci5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMucGxheWJhY2tTb3VyY2UpIHtcbiAgICAgICAgICAgIHRoaXMucGxheWJhY2tTb3VyY2Uuc3RvcCgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBDYWxsZWQgYWZ0ZXIgZWFjaCBhdWRpb1Byb2Nlc3MuIENoZWNrIGZvciBzaWxlbmNlIGFuZCBnaXZlIGZmdCB0aW1lIGRvbWFpbiBkYXRhIHRvIHZpc3VhbGl6ZXIuXG4gICAgICovXG4gICAgQXVkaW9SZWNvcmRlci5wcm90b3R5cGUuYW5hbHlzZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmF1ZGlvU3VwcG9ydGVkKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB2YXIgYW5hbHlzZXIgPSB0aGlzLmFuYWx5c2VyTm9kZTtcbiAgICAgICAgYW5hbHlzZXIuZmZ0U2l6ZSA9IEZGVF9TSVpFO1xuICAgICAgICB2YXIgYnVmZmVyTGVuZ3RoID0gYW5hbHlzZXIuZmZ0U2l6ZTtcbiAgICAgICAgdmFyIGRhdGFBcnJheSA9IG5ldyBVaW50OEFycmF5KGJ1ZmZlckxlbmd0aCk7XG4gICAgICAgIHZhciBhbXBsaXR1ZGUgPSB0aGlzLm9wdGlvbnMuYW1wbGl0dWRlO1xuICAgICAgICB2YXIgdGltZSA9IHRoaXMub3B0aW9ucy50aW1lO1xuICAgICAgICBhbmFseXNlci5nZXRCeXRlVGltZURvbWFpbkRhdGEoZGF0YUFycmF5KTtcbiAgICAgICAgdGhpcy52aXN1YWxpemVyKGRhdGFBcnJheSwgYnVmZmVyTGVuZ3RoKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBidWZmZXJMZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgLy8gTm9ybWFsaXplIGJldHdlZW4gLTEgYW5kIDEuXG4gICAgICAgICAgICB2YXIgY3Vycl92YWx1ZV90aW1lID0gZGF0YUFycmF5W2ldIC8gMTI4IC0gMS4wO1xuICAgICAgICAgICAgaWYgKGN1cnJfdmFsdWVfdGltZSA+IGFtcGxpdHVkZSB8fCBjdXJyX3ZhbHVlX3RpbWUgPCAtMSAqIGFtcGxpdHVkZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhcnQgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHZhciBuZXd0aW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgdmFyIGVsYXBzZWRUaW1lID0gbmV3dGltZSAtIHRoaXMuc3RhcnQ7XG4gICAgICAgIGlmIChlbGFwc2VkVGltZSA+IHRpbWUpIHtcbiAgICAgICAgICAgIHRoaXMub25TaWxlbmNlKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEVuY29kZXMgcmVjb3JkZWQgYnVmZmVyIHRvIGEgd2F2IGZpbGUgYW5kIGV4cG9ydHMgaXQgdG8gYSBibG9iLlxuICAgICAqXG4gICAgICogQHBhcmFtIGV4cG9ydFNhbXBsZVJhdGUge251bWJlcn0gLSBkZXNpcmVkIHNhbXBsZSByYXRlIG9mIHRoZSBleHBvcnRlZCBidWZmZXJcbiAgICAgKi9cbiAgICBBdWRpb1JlY29yZGVyLnByb3RvdHlwZS5leHBvcnRXQVYgPSBmdW5jdGlvbiAoZXhwb3J0U2FtcGxlUmF0ZSkge1xuICAgICAgICBpZiAoZXhwb3J0U2FtcGxlUmF0ZSA9PT0gdm9pZCAwKSB7IGV4cG9ydFNhbXBsZVJhdGUgPSBERUZBVUxUX0VYUE9SVF9TQU1QTEVfUkFURTsgfVxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgcmVjb3JkU2FtcGxlUmF0ZSwgYmxvYjtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuYXVkaW9TdXBwb3J0ZWQpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICByZWNvcmRTYW1wbGVSYXRlID0gdGhpcy5hdWRpb0NvbnRleHQuc2FtcGxlUmF0ZTtcbiAgICAgICAgICAgICAgICBibG9iID0gZXhwb3J0QnVmZmVyKHRoaXMuc3RyZWFtQnVmZmVyLCB0aGlzLnN0cmVhbUJ1ZmZlckxlbmd0aCwgcmVjb3JkU2FtcGxlUmF0ZSwgZXhwb3J0U2FtcGxlUmF0ZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5jbGVhcigpO1xuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBibG9iXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHJldHVybiBBdWRpb1JlY29yZGVyO1xufSgpKTtcbnZhciB2aXN1YWxpemUgPSBmdW5jdGlvbiAoZGF0YUFycmF5LCBidWZmZXJMZW5ndGgsIGNhbnZhcykge1xuICAgIGlmICghY2FudmFzKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKCFicm93c2VyT3JOb2RlKCkuaXNCcm93c2VyKVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Zpc3VhbGl6YXRpb24gaXMgbm90IHN1cHBvcnRlZCBvbiBub24tYnJvd3NlcnMuJyk7XG4gICAgdmFyIF9hID0gY2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLCB3aWR0aCA9IF9hLndpZHRoLCBoZWlnaHQgPSBfYS5oZWlnaHQ7XG4gICAgLy8gbmVlZCB0byB1cGRhdGUgdGhlIGRlZmF1bHQgY2FudmFzIHdpZHRoIGFuZCBoZWlnaHRcbiAgICBjYW52YXMud2lkdGggPSB3aWR0aDtcbiAgICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgIHZhciBjYW52YXNDdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICBjYW52YXNDdHguZmlsbFN0eWxlID0gJ3doaXRlJztcbiAgICBjYW52YXNDdHguY2xlYXJSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuICAgIHZhciBkcmF3ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBjYW52YXNDdHguZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7XG4gICAgICAgIGNhbnZhc0N0eC5saW5lV2lkdGggPSAxO1xuICAgICAgICB2YXIgY29sb3IgPSBnZXRDb21wdXRlZFN0eWxlKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkuZ2V0UHJvcGVydHlWYWx1ZSgnLS1hbXBsaWZ5LXByaW1hcnktY29sb3InKTtcbiAgICAgICAgY2FudmFzQ3R4LnN0cm9rZVN0eWxlID0gIWNvbG9yIHx8IGNvbG9yID09PSAnJyA/ICcjZmY5OTAwJyA6IGNvbG9yOyAvLyBUT0RPOiB0cnkgc2VwYXJhdGUgY3NzIHZhcmlhYmxlXG4gICAgICAgIGNhbnZhc0N0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgdmFyIHNsaWNlV2lkdGggPSAod2lkdGggKiAxLjApIC8gYnVmZmVyTGVuZ3RoO1xuICAgICAgICB2YXIgeCA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYnVmZmVyTGVuZ3RoIHx8IGkgJSAzID09PSAwOyBpKyspIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGRhdGFBcnJheVtpXSAvIDEyOC4wO1xuICAgICAgICAgICAgdmFyIHkgPSAodmFsdWUgKiBoZWlnaHQpIC8gMjtcbiAgICAgICAgICAgIGlmIChpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgY2FudmFzQ3R4Lm1vdmVUbyh4LCB5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNhbnZhc0N0eC5saW5lVG8oeCwgeSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB4ICs9IHNsaWNlV2lkdGg7XG4gICAgICAgIH1cbiAgICAgICAgY2FudmFzQ3R4LmxpbmVUbyhjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQgLyAyKTtcbiAgICAgICAgY2FudmFzQ3R4LnN0cm9rZSgpO1xuICAgIH07XG4gICAgLy8gUmVnaXN0ZXIgb3VyIGRyYXcgZnVuY3Rpb24gd2l0aCByZXF1ZXN0QW5pbWF0aW9uRnJhbWUuXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGRyYXcpO1xufTtcbnZhciBhbXBsaWZ5Q2hhdGJvdENzcyA9IFwiLmJvdCAuZG90e2JhY2tncm91bmQtY29sb3I6dmFyKC0tYm90LWRvdC1jb2xvcil9LnVzZXIgLmRvdHtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLXVzZXItZG90LWNvbG9yKX0uZG90LWZsYXNoaW5ne3dpZHRoOjIuNjI1cmVtfS5kb3QtZmxhc2hpbmcgLmRvdHtkaXNwbGF5OmlubGluZS1ibG9jazt3aWR0aDowLjYyNXJlbTtoZWlnaHQ6MC42MjVyZW07Ym9yZGVyLXJhZGl1czoxMHJlbTtvcGFjaXR5OjAuNjV9LmRvdC1mbGFzaGluZyAubGVmdHstd2Via2l0LWFuaW1hdGlvbjpkb3QtZmxhc2hpbmcgMXMgaW5maW5pdGUgYWx0ZXJuYXRlO2FuaW1hdGlvbjpkb3QtZmxhc2hpbmcgMXMgaW5maW5pdGUgYWx0ZXJuYXRlOy13ZWJraXQtYW5pbWF0aW9uLWRlbGF5OjBzO2FuaW1hdGlvbi1kZWxheTowc30uZG90LWZsYXNoaW5nIC5taWRkbGV7bWFyZ2luLWxlZnQ6MC4zNzVyZW07bWFyZ2luLXJpZ2h0OjAuMzc1cmVtOy13ZWJraXQtYW5pbWF0aW9uOmRvdC1mbGFzaGluZyAxcyBpbmZpbml0ZSBsaW5lYXIgYWx0ZXJuYXRlO2FuaW1hdGlvbjpkb3QtZmxhc2hpbmcgMXMgaW5maW5pdGUgbGluZWFyIGFsdGVybmF0ZTstd2Via2l0LWFuaW1hdGlvbi1kZWxheTowLjVzO2FuaW1hdGlvbi1kZWxheTowLjVzfS5kb3QtZmxhc2hpbmcgLnJpZ2h0ey13ZWJraXQtYW5pbWF0aW9uOmRvdC1mbGFzaGluZyAxcyBpbmZpbml0ZSBhbHRlcm5hdGU7YW5pbWF0aW9uOmRvdC1mbGFzaGluZyAxcyBpbmZpbml0ZSBhbHRlcm5hdGU7LXdlYmtpdC1hbmltYXRpb24tZGVsYXk6MXM7YW5pbWF0aW9uLWRlbGF5OjFzfUAtd2Via2l0LWtleWZyYW1lcyBkb3QtZmxhc2hpbmd7MCV7b3BhY2l0eTowLjY1fTUwJSwxMDAle29wYWNpdHk6MC4xfX1Aa2V5ZnJhbWVzIGRvdC1mbGFzaGluZ3swJXtvcGFjaXR5OjAuNjV9NTAlLDEwMCV7b3BhY2l0eTowLjF9fTpob3N0ey0td2lkdGg6MjguNzVyZW07LS1oZWlnaHQ6MzcuNXJlbTstLWhlYWRlci1jb2xvcjp2YXIoLS1hbXBsaWZ5LXNlY29uZGFyeS1jb2xvcik7LS1oZWFkZXItc2l6ZTp2YXIoLS1hbXBsaWZ5LXRleHQtbGcpOy0tYm90LWJhY2tncm91bmQtY29sb3I6cmdiKDIzMCwgMjMwLCAyMzApOy0tYm90LXRleHQtY29sb3I6YmxhY2s7LS1ib3QtZG90LWNvbG9yOnZhcigtLWJvdC10ZXh0LWNvbG9yKTstLXVzZXItYmFja2dyb3VuZC1jb2xvcjp2YXIoLS1hbXBsaWZ5LWJsdWUpOy0tdXNlci10ZXh0LWNvbG9yOnZhcigtLWFtcGxpZnktd2hpdGUpOy0tdXNlci1kb3QtY29sb3I6dmFyKC0tdXNlci10ZXh0LWNvbG9yKX0uYW1wbGlmeS1jaGF0Ym90e2Rpc3BsYXk6LW1zLWlubGluZS1mbGV4Ym94O2Rpc3BsYXk6aW5saW5lLWZsZXg7LW1zLWZsZXgtZGlyZWN0aW9uOmNvbHVtbjtmbGV4LWRpcmVjdGlvbjpjb2x1bW47YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1iYWNrZ3JvdW5kLWNvbG9yKTtib3JkZXItcmFkaXVzOjAuMzc1cmVtOy13ZWJraXQtYm94LXNoYWRvdzowLjA2MjVyZW0gMHJlbSAwLjI1cmVtIDAgcmdiYSgwLCAwLCAwLCAwLjE1KTtib3gtc2hhZG93OjAuMDYyNXJlbSAwcmVtIDAuMjVyZW0gMCByZ2JhKDAsIDAsIDAsIDAuMTUpOy13ZWJraXQtYm94LXNpemluZzpib3JkZXItYm94O2JveC1zaXppbmc6Ym9yZGVyLWJveDtmb250LWZhbWlseTp2YXIoLS1hbXBsaWZ5LWZvbnQtZmFtaWx5KTttYXJnaW4tYm90dG9tOjFyZW07d2lkdGg6MTAwJTtoZWlnaHQ6dmFyKC0taGVpZ2h0KTttYXgtd2lkdGg6dmFyKC0td2lkdGgpfUBtZWRpYSAobWluLXdpZHRoOiA2NzJweCl7LmFtcGxpZnktY2hhdGJvdHt3aWR0aDp2YXIoLS13aWR0aCl9fS5oZWFkZXJ7cGFkZGluZzoxLjI1cmVtIDAuMzc1cmVtIDEuMjVyZW0gMC4zNzVyZW07Y29sb3I6dmFyKC0taGVhZGVyLWNvbG9yKTtmb250LXNpemU6dmFyKC0taGVhZGVyLXNpemUpO2ZvbnQtd2VpZ2h0OmJvbGQ7dGV4dC1hbGlnbjpjZW50ZXI7d29yZC13cmFwOmJyZWFrLXdvcmR9LmJvZHl7Ym9yZGVyLXRvcDowLjA2MjVyZW0gc29saWQgcmdiYSgwLCAwLCAwLCAwLjA1KTtwYWRkaW5nOjEuNXJlbSAxcmVtIDAgMXJlbTtkaXNwbGF5Oi1tcy1mbGV4Ym94O2Rpc3BsYXk6ZmxleDstbXMtZmxleC1wb3NpdGl2ZToxO2ZsZXgtZ3JvdzoxOy1tcy1mbGV4LWRpcmVjdGlvbjpjb2x1bW47ZmxleC1kaXJlY3Rpb246Y29sdW1uO292ZXJmbG93OmF1dG99LmJ1YmJsZXttYXgtd2lkdGg6MTAwJTtwYWRkaW5nOjAuOGVtIDEuNGVtO3RleHQtYWxpZ246bGVmdDt3b3JkLXdyYXA6YnJlYWstd29yZDttYXJnaW4tYm90dG9tOjAuNjI1cmVtfS5ib3R7bWFyZ2luLXJpZ2h0OmF1dG87YmFja2dyb3VuZC1jb2xvcjp2YXIoLS1ib3QtYmFja2dyb3VuZC1jb2xvcik7Y29sb3I6dmFyKC0tYm90LXRleHQtY29sb3IpO2JvcmRlci1yYWRpdXM6MS41cmVtIDEuNXJlbSAxLjVyZW0gMH0udXNlcnttYXJnaW4tbGVmdDphdXRvO2JhY2tncm91bmQtY29sb3I6dmFyKC0tdXNlci1iYWNrZ3JvdW5kLWNvbG9yKTtjb2xvcjp2YXIoLS11c2VyLXRleHQtY29sb3IpO2JvcmRlci1yYWRpdXM6MS41cmVtIDEuNXJlbSAwIDEuNXJlbX0uZm9vdGVye2Rpc3BsYXk6LW1zLWZsZXhib3g7ZGlzcGxheTpmbGV4Oy1tcy1mbGV4LWFsaWduOmNlbnRlcjthbGlnbi1pdGVtczpjZW50ZXI7Ym9yZGVyLXRvcDowLjA2MnJlbSBzb2xpZCByZ2JhKDAsIDAsIDAsIDAuMDUpO3BhZGRpbmctcmlnaHQ6MC42MjVyZW07bWluLWhlaWdodDozLjEyNXJlbX0uZm9vdGVyIGFtcGxpZnktaW5wdXR7LS1ib3JkZXI6bm9uZTstLW1hcmdpbjowOy1tcy1mbGV4LXBvc2l0aXZlOjE7ZmxleC1ncm93OjF9Y2FudmFze21hcmdpbi1sZWZ0OjAuNjI1cmVtO21hcmdpbi1yaWdodDowLjYyNXJlbTstbXMtZmxleC1wb3NpdGl2ZToxO2ZsZXgtZ3JvdzoxO2hlaWdodDozLjEyNXJlbX0uaWNvbi1idXR0b257LS1pY29uLWhlaWdodDoxLjI1cmVtOy0taWNvbi1maWxsOnZhcigtLWFtcGxpZnktcHJpbWFyeS1jb2xvcik7LS1wYWRkaW5nOjAuNjI1cmVtOy0td2lkdGg6YXV0b31cIjtcbi8vIGVudW0gZm9yIHBvc3NpYmxlIGJvdCBzdGF0ZXNcbnZhciBDaGF0U3RhdGU7XG4oZnVuY3Rpb24gKENoYXRTdGF0ZSkge1xuICAgIENoYXRTdGF0ZVtDaGF0U3RhdGVbXCJJbml0aWFsXCJdID0gMF0gPSBcIkluaXRpYWxcIjtcbiAgICBDaGF0U3RhdGVbQ2hhdFN0YXRlW1wiTGlzdGVuaW5nXCJdID0gMV0gPSBcIkxpc3RlbmluZ1wiO1xuICAgIENoYXRTdGF0ZVtDaGF0U3RhdGVbXCJTZW5kaW5nVGV4dFwiXSA9IDJdID0gXCJTZW5kaW5nVGV4dFwiO1xuICAgIENoYXRTdGF0ZVtDaGF0U3RhdGVbXCJTZW5kaW5nVm9pY2VcIl0gPSAzXSA9IFwiU2VuZGluZ1ZvaWNlXCI7XG4gICAgQ2hhdFN0YXRlW0NoYXRTdGF0ZVtcIkVycm9yXCJdID0gNF0gPSBcIkVycm9yXCI7XG59KShDaGF0U3RhdGUgfHwgKENoYXRTdGF0ZSA9IHt9KSk7XG4vLyBNZXNzYWdlIHR5cGVzXG52YXIgTWVzc2FnZUZyb207XG4oZnVuY3Rpb24gKE1lc3NhZ2VGcm9tKSB7XG4gICAgTWVzc2FnZUZyb21bXCJCb3RcIl0gPSBcImJvdFwiO1xuICAgIE1lc3NhZ2VGcm9tW1wiVXNlclwiXSA9IFwidXNlclwiO1xufSkoTWVzc2FnZUZyb20gfHwgKE1lc3NhZ2VGcm9tID0ge30pKTtcbi8vIEVycm9yIHR5cGVzXG52YXIgQ2hhdEVycm9yVHlwZTtcbihmdW5jdGlvbiAoQ2hhdEVycm9yVHlwZSkge1xuICAgIENoYXRFcnJvclR5cGVbQ2hhdEVycm9yVHlwZVtcIlJlY292ZXJhYmxlXCJdID0gMF0gPSBcIlJlY292ZXJhYmxlXCI7XG4gICAgQ2hhdEVycm9yVHlwZVtDaGF0RXJyb3JUeXBlW1wiVW5yZWNvdmVyYWJsZVwiXSA9IDFdID0gXCJVbnJlY292ZXJhYmxlXCI7XG59KShDaGF0RXJyb3JUeXBlIHx8IChDaGF0RXJyb3JUeXBlID0ge30pKTtcbnZhciBBbXBsaWZ5Q2hhdGJvdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBjbGFzc18xKGhvc3RSZWYpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgLyoqIENsZWFyIG1lc3NhZ2VzIHdoZW4gY29udmVyc2F0aW9uIGZpbmlzaGVzICovXG4gICAgICAgIHRoaXMuY2xlYXJPbkNvbXBsZXRlID0gZmFsc2U7XG4gICAgICAgIC8qKiBDb250aW51ZSBsaXN0ZW5pbmcgdG8gdXNlcnMgYWZ0ZXIgdGhleSBzZW5kIHRoZSBtZXNzYWdlICovXG4gICAgICAgIHRoaXMuY29udmVyc2F0aW9uTW9kZU9uID0gZmFsc2U7XG4gICAgICAgIC8qKiBUZXh0IHBsYWNlZCBpbiB0aGUgdG9wIGhlYWRlciAqL1xuICAgICAgICB0aGlzLmJvdFRpdGxlID0gVHJhbnNsYXRpb25zLkNIQVRCT1RfVElUTEU7XG4gICAgICAgIC8qKiBXaGV0aGVyIHZvaWNlIGNoYXQgaXMgZW5hYmxlZCAqL1xuICAgICAgICB0aGlzLnZvaWNlRW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICAvKiogV2hldGhlciB0ZXh0IGNoYXQgaXMgZW5hYmxlZCAqL1xuICAgICAgICB0aGlzLnRleHRFbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgLyoqIEFtb3VudCBvZiBzaWxlbmNlIChpbiBtcykgdG8gd2FpdCBmb3IgKi9cbiAgICAgICAgdGhpcy5zaWxlbmNlVGltZSA9IDE1MDA7XG4gICAgICAgIC8qKiBOb2lzZSB0aHJlc2hvbGQgYmV0d2VlbiAtMSBhbmQgMS4gQW55dGhpbmcgYmVsb3cgaXMgY29uc2lkZXJlZCBhIHNpbGVuY2UuICovXG4gICAgICAgIHRoaXMuc2lsZW5jZVRocmVzaG9sZCA9IDAuMjtcbiAgICAgICAgLyoqIE1lc3NhZ2VzIGluIGN1cnJlbnQgc2Vzc2lvbiAqL1xuICAgICAgICB0aGlzLm1lc3NhZ2VzID0gW107XG4gICAgICAgIC8qKiBUZXh0IGlucHV0IGJveCB2YWx1ZSAgKi9cbiAgICAgICAgdGhpcy50ZXh0ID0gJyc7XG4gICAgICAgIC8qKiBDdXJyZW50IGFwcCBzdGF0ZSAqL1xuICAgICAgICB0aGlzLmNoYXRTdGF0ZSA9IENoYXRTdGF0ZS5Jbml0aWFsO1xuICAgICAgICAvKipcbiAgICAgICAgICogUmVuZGVyaW5nIG1ldGhvZHNcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubWVzc2FnZUpTWCA9IGZ1bmN0aW9uIChtZXNzYWdlcykge1xuICAgICAgICAgICAgdmFyIG1lc3NhZ2VMaXN0ID0gbWVzc2FnZXMubWFwKGZ1bmN0aW9uIChtZXNzYWdlKSB7IHJldHVybiAoaChcImRpdlwiLCB7IGNsYXNzOiBcImJ1YmJsZSBcIiArIG1lc3NhZ2UuZnJvbSB9LCBtZXNzYWdlLmNvbnRlbnQpKTsgfSk7XG4gICAgICAgICAgICBpZiAoX3RoaXMuY2hhdFN0YXRlID09PSBDaGF0U3RhdGUuU2VuZGluZ1RleHQgfHxcbiAgICAgICAgICAgICAgICBfdGhpcy5jaGF0U3RhdGUgPT09IENoYXRTdGF0ZS5TZW5kaW5nVm9pY2UpIHtcbiAgICAgICAgICAgICAgICAvLyBpZiB3YWl0aW5nIGZvciB2b2ljZSBtZXNzYWdlLCBzaG93IGFuaW1hdGlvbiBvbiB1c2VyIHNpZGUgYmVjYXVzZSBhcHAgaXMgd2FpdGluZyBmb3IgdHJhbnNjcmlwdC4gRWxzZSBwdXQgaXQgb24gYm90IHNpZGUuXG4gICAgICAgICAgICAgICAgdmFyIGNsaWVudCA9IF90aGlzLmNoYXRTdGF0ZSA9PT0gQ2hhdFN0YXRlLlNlbmRpbmdUZXh0XG4gICAgICAgICAgICAgICAgICAgID8gTWVzc2FnZUZyb20uQm90XG4gICAgICAgICAgICAgICAgICAgIDogTWVzc2FnZUZyb20uVXNlcjtcbiAgICAgICAgICAgICAgICBtZXNzYWdlTGlzdC5wdXNoKGgoXCJkaXZcIiwgeyBjbGFzczogXCJidWJibGUgXCIgKyBjbGllbnQgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImRvdC1mbGFzaGluZyBcIiArIGNsaWVudCB9LCBoKFwic3BhblwiLCB7IGNsYXNzOiBcImRvdCBsZWZ0XCIgfSksIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwiZG90IG1pZGRsZVwiIH0pLCBoKFwic3BhblwiLCB7IGNsYXNzOiBcImRvdCByaWdodFwiIH0pKSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2VMaXN0O1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNoYXRDb21wbGV0ZWQgPSBjcmVhdGVFdmVudCh0aGlzLCBcImNoYXRDb21wbGV0ZWRcIiwgNyk7XG4gICAgfVxuICAgIC8vIE9jY3VycyB3aGVuIHVzZXIgcHJlc3NlcyBlbnRlciBpbiBpbnB1dCBib3hcbiAgICBjbGFzc18xLnByb3RvdHlwZS5zdWJtaXRIYW5kbGVyID0gZnVuY3Rpb24gKF9ldmVudCkge1xuICAgICAgICB0aGlzLnNlbmRUZXh0TWVzc2FnZSgpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogTGlmZWN5Y2xlIGZ1bmN0aW9uc1xuICAgICAqL1xuICAgIGNsYXNzXzEucHJvdG90eXBlLmNvbXBvbmVudFdpbGxMb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIUludGVyYWN0aW9ucyB8fCB0eXBlb2YgSW50ZXJhY3Rpb25zLm9uQ29tcGxldGUgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihOT19JTlRFUkFDVElPTlNfTU9EVUxFX0ZPVU5EKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnZhbGlkYXRlUHJvcHMoKTtcbiAgICB9O1xuICAgIGNsYXNzXzEucHJvdG90eXBlLmNvbXBvbmVudERpZFJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gc2Nyb2xsIHRvIHRoZSBib3R0b20gaWYgbmVjZXNzYXJ5XG4gICAgICAgIHZhciBib2R5ID0gdGhpcy5lbGVtZW50LnNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcignLmJvZHknKTtcbiAgICAgICAgYm9keS5zY3JvbGxUb3AgPSBib2R5LnNjcm9sbEhlaWdodDtcbiAgICB9O1xuICAgIGNsYXNzXzEucHJvdG90eXBlLnZhbGlkYXRlUHJvcHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmICghdGhpcy52b2ljZUVuYWJsZWQgJiYgIXRoaXMudGV4dEVuYWJsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0RXJyb3IoVHJhbnNsYXRpb25zLkNIQVRfRElTQUJMRURfRVJST1IsIENoYXRFcnJvclR5cGUuVW5yZWNvdmVyYWJsZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIXRoaXMuYm90TmFtZSkge1xuICAgICAgICAgICAgdGhpcy5zZXRFcnJvcihUcmFuc2xhdGlvbnMuTk9fQk9UX05BTUVfRVJST1IsIENoYXRFcnJvclR5cGUuVW5yZWNvdmVyYWJsZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMud2VsY29tZU1lc3NhZ2UpXG4gICAgICAgICAgICB0aGlzLmFwcGVuZFRvQ2hhdCh0aGlzLndlbGNvbWVNZXNzYWdlLCBNZXNzYWdlRnJvbS5Cb3QpO1xuICAgICAgICAvLyBJbml0aWFsaXplIEF1ZGlvUmVjb3JkZXIgaWYgdm9pY2UgaXMgZW5hYmxlZFxuICAgICAgICBpZiAodGhpcy52b2ljZUVuYWJsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuYXVkaW9SZWNvcmRlciA9IG5ldyBBdWRpb1JlY29yZGVyKHtcbiAgICAgICAgICAgICAgICB0aW1lOiB0aGlzLnNpbGVuY2VUaW1lLFxuICAgICAgICAgICAgICAgIGFtcGxpdHVkZTogdGhpcy5zaWxlbmNlVGhyZXNob2xkLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLmF1ZGlvUmVjb3JkZXIuaW5pdCgpLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5zZXRFcnJvcihlcnIsIENoYXRFcnJvclR5cGUuUmVjb3ZlcmFibGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIGFmdGVyIGNoYXQgaXMgY29tcGxldGVkXG4gICAgICAgIHZhciBvbkNvbXBsZXRlID0gZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgICAgICAgX3RoaXMuY2hhdENvbXBsZXRlZC5lbWl0KHtcbiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgICAgICAgIGVycjogZXJyLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoX3RoaXMuY2xlYXJPbkNvbXBsZXRlKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMucmVzZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIF90aGlzLmNoYXRTdGF0ZSA9IENoYXRTdGF0ZS5Jbml0aWFsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgSW50ZXJhY3Rpb25zLm9uQ29tcGxldGUodGhpcy5ib3ROYW1lLCBvbkNvbXBsZXRlKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICB0aGlzLnNldEVycm9yKGVyciwgQ2hhdEVycm9yVHlwZS5VbnJlY292ZXJhYmxlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgLyoqXG4gICAgICogSGFuZGxlcnNcbiAgICAgKi9cbiAgICBjbGFzc18xLnByb3RvdHlwZS5oYW5kbGVTdWJtaXQgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdGhpcy5zZW5kVGV4dE1lc3NhZ2UoKTtcbiAgICB9O1xuICAgIGNsYXNzXzEucHJvdG90eXBlLmhhbmRsZU1pY0J1dHRvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgaWYgKHRoaXMuY2hhdFN0YXRlICE9PSBDaGF0U3RhdGUuSW5pdGlhbClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGhpcy5hdWRpb1JlY29yZGVyLnN0b3AoKTtcbiAgICAgICAgdGhpcy5jaGF0U3RhdGUgPSBDaGF0U3RhdGUuTGlzdGVuaW5nO1xuICAgICAgICB0aGlzLmF1ZGlvUmVjb3JkZXIuc3RhcnRSZWNvcmRpbmcoZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuaGFuZGxlU2lsZW5jZSgpOyB9LCBmdW5jdGlvbiAoZGF0YSwgbGVuZ3RoKSB7IHJldHVybiBfdGhpcy52aXN1YWxpemVyKGRhdGEsIGxlbmd0aCk7IH0pO1xuICAgIH07XG4gICAgY2xhc3NfMS5wcm90b3R5cGUuaGFuZGxlU2lsZW5jZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5jaGF0U3RhdGUgPSBDaGF0U3RhdGUuU2VuZGluZ1ZvaWNlO1xuICAgICAgICB0aGlzLmF1ZGlvUmVjb3JkZXIuc3RvcFJlY29yZGluZygpO1xuICAgICAgICB0aGlzLmF1ZGlvUmVjb3JkZXIuZXhwb3J0V0FWKCkudGhlbihmdW5jdGlvbiAoYmxvYikge1xuICAgICAgICAgICAgX3RoaXMuc2VuZFZvaWNlTWVzc2FnZShibG9iKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBjbGFzc18xLnByb3RvdHlwZS5oYW5kbGVUZXh0Q2hhbmdlID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQ7XG4gICAgICAgIHRoaXMudGV4dCA9IHRhcmdldC52YWx1ZTtcbiAgICB9O1xuICAgIGNsYXNzXzEucHJvdG90eXBlLmhhbmRsZUNhbmNlbEJ1dHRvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5hdWRpb1JlY29yZGVyLmNsZWFyKCk7XG4gICAgICAgIHRoaXMuY2hhdFN0YXRlID0gQ2hhdFN0YXRlLkluaXRpYWw7XG4gICAgfTtcbiAgICBjbGFzc18xLnByb3RvdHlwZS5oYW5kbGVUb2FzdENsb3NlID0gZnVuY3Rpb24gKGVycm9yVHlwZSkge1xuICAgICAgICB0aGlzLmVycm9yID0gdW5kZWZpbmVkOyAvLyBjbGVhciBlcnJvclxuICAgICAgICAvLyBpZiBlcnJvciBpcyByZWNvdmVyYWJsZSwgcmVzZXQgdGhlIGFwcCBzdGF0ZSB0byBpbml0aWFsXG4gICAgICAgIGlmIChlcnJvclR5cGUgPT09IENoYXRFcnJvclR5cGUuUmVjb3ZlcmFibGUpIHtcbiAgICAgICAgICAgIHRoaXMuY2hhdFN0YXRlID0gQ2hhdFN0YXRlLkluaXRpYWw7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFZpc3VhbGl6YXRpb25cbiAgICAgKi9cbiAgICBjbGFzc18xLnByb3RvdHlwZS52aXN1YWxpemVyID0gZnVuY3Rpb24gKGRhdGFBcnJheSwgYnVmZmVyTGVuZ3RoKSB7XG4gICAgICAgIHZhciBjYW52YXMgPSB0aGlzLmVsZW1lbnQuc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKCdjYW52YXMnKTtcbiAgICAgICAgdmlzdWFsaXplKGRhdGFBcnJheSwgYnVmZmVyTGVuZ3RoLCBjYW52YXMpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogSW50ZXJhY3Rpb25zIGhlbHBlcnNcbiAgICAgKi9cbiAgICBjbGFzc18xLnByb3RvdHlwZS5zZW5kVGV4dE1lc3NhZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB0ZXh0LCByZXNwb25zZSwgZXJyXzM7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50ZXh0Lmxlbmd0aCA9PT0gMCB8fCB0aGlzLmNoYXRTdGF0ZSAhPT0gQ2hhdFN0YXRlLkluaXRpYWwpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHRoaXMudGV4dDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGV4dCA9ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBlbmRUb0NoYXQodGV4dCwgTWVzc2FnZUZyb20uVXNlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYXRTdGF0ZSA9IENoYXRTdGF0ZS5TZW5kaW5nVGV4dDtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gMTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2EudHJ5cy5wdXNoKFsxLCAzLCAsIDRdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIEludGVyYWN0aW9ucy5zZW5kKHRoaXMuYm90TmFtZSwgdGV4dCldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDRdO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJfMyA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RXJyb3IoZXJyXzMsIENoYXRFcnJvclR5cGUuUmVjb3ZlcmFibGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UubWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kVG9DaGF0KHJlc3BvbnNlLm1lc3NhZ2UsIE1lc3NhZ2VGcm9tLkJvdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYXRTdGF0ZSA9IENoYXRTdGF0ZS5Jbml0aWFsO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIGNsYXNzXzEucHJvdG90eXBlLnNlbmRWb2ljZU1lc3NhZ2UgPSBmdW5jdGlvbiAoYXVkaW9JbnB1dCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgaW50ZXJhY3Rpb25zTWVzc2FnZSwgcmVzcG9uc2UsIGVycl80LCBkaWFsb2dTdGF0ZTtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmFjdGlvbnNNZXNzYWdlID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGF1ZGlvSW5wdXQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlVHlwZTogJ3ZvaWNlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gMTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2EudHJ5cy5wdXNoKFsxLCAzLCAsIDRdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIEludGVyYWN0aW9ucy5zZW5kKHRoaXMuYm90TmFtZSwgaW50ZXJhY3Rpb25zTWVzc2FnZSldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDRdO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJfNCA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RXJyb3IoZXJyXzQsIENoYXRFcnJvclR5cGUuUmVjb3ZlcmFibGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYXRTdGF0ZSA9IENoYXRTdGF0ZS5Jbml0aWFsO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlhbG9nU3RhdGUgPSByZXNwb25zZS5kaWFsb2dTdGF0ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5pbnB1dFRyYW5zY3JpcHQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBlbmRUb0NoYXQocmVzcG9uc2UuaW5wdXRUcmFuc2NyaXB0LCBNZXNzYWdlRnJvbS5Vc2VyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kVG9DaGF0KHJlc3BvbnNlLm1lc3NhZ2UsIE1lc3NhZ2VGcm9tLkJvdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLmF1ZGlvUmVjb3JkZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnBsYXkocmVzcG9uc2UuYXVkaW9TdHJlYW0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgY29udmVyc2F0aW9uTW9kZSBpcyBvbiwgY2hhdCBpcyBpbmNvbXBsZXRlLCBhbmQgbWljIGJ1dHRvbiBpc24ndCBwcmVzc2VkIHlldCwgcmVzdW1lIGxpc3RlbmluZy5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLmNvbnZlcnNhdGlvbk1vZGVPbiAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlhbG9nU3RhdGUgIT09ICdGdWxmaWxsZWQnICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaWFsb2dTdGF0ZSAhPT0gJ0ZhaWxlZCcgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNoYXRTdGF0ZSA9PT0gQ2hhdFN0YXRlLkluaXRpYWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmhhbmRsZU1pY0J1dHRvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsgcmV0dXJuIF90aGlzLnNldEVycm9yKGVyciwgQ2hhdEVycm9yVHlwZS5SZWNvdmVyYWJsZSk7IH0pXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIGNsYXNzXzEucHJvdG90eXBlLmFwcGVuZFRvQ2hhdCA9IGZ1bmN0aW9uIChjb250ZW50LCBmcm9tKSB7XG4gICAgICAgIHRoaXMubWVzc2FnZXMgPSBfX3NwcmVhZEFycmF5cyh0aGlzLm1lc3NhZ2VzLCBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgY29udGVudDogY29udGVudCxcbiAgICAgICAgICAgICAgICBmcm9tOiBmcm9tLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgXSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBTdGF0ZSBjb250cm9sIG1ldGhvZHNcbiAgICAgKi9cbiAgICBjbGFzc18xLnByb3RvdHlwZS5zZXRFcnJvciA9IGZ1bmN0aW9uIChlcnJvciwgZXJyb3JUeXBlKSB7XG4gICAgICAgIHZhciBtZXNzYWdlID0gdHlwZW9mIGVycm9yID09PSAnc3RyaW5nJyA/IGVycm9yIDogZXJyb3IubWVzc2FnZTtcbiAgICAgICAgdGhpcy5jaGF0U3RhdGUgPSBDaGF0U3RhdGUuRXJyb3I7XG4gICAgICAgIHRoaXMuZXJyb3IgPSB7IG1lc3NhZ2U6IG1lc3NhZ2UsIGVycm9yVHlwZTogZXJyb3JUeXBlIH07XG4gICAgfTtcbiAgICBjbGFzc18xLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5jaGF0U3RhdGUgPSBDaGF0U3RhdGUuSW5pdGlhbDtcbiAgICAgICAgdGhpcy50ZXh0ID0gJyc7XG4gICAgICAgIHRoaXMuZXJyb3IgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubWVzc2FnZXMgPSBbXTtcbiAgICAgICAgaWYgKHRoaXMud2VsY29tZU1lc3NhZ2UpXG4gICAgICAgICAgICB0aGlzLmFwcGVuZFRvQ2hhdCh0aGlzLndlbGNvbWVNZXNzYWdlLCBNZXNzYWdlRnJvbS5Cb3QpO1xuICAgICAgICB0aGlzLmF1ZGlvUmVjb3JkZXIgJiYgdGhpcy5hdWRpb1JlY29yZGVyLmNsZWFyKCk7XG4gICAgfTtcbiAgICBjbGFzc18xLnByb3RvdHlwZS5saXN0ZW5pbmdGb290ZXJKU1ggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciB2aXN1YWxpemF0aW9uID0gaChcImNhbnZhc1wiLCB7IGhlaWdodDogXCI1MFwiIH0pO1xuICAgICAgICB2YXIgY2FuY2VsQnV0dG9uID0gKGgoXCJhbXBsaWZ5LWJ1dHRvblwiLCB7IFwiZGF0YS10ZXN0XCI6IFwiY2hhdGJvdC1jYW5jZWwtYnV0dG9uXCIsIGhhbmRsZUJ1dHRvbkNsaWNrOiBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5oYW5kbGVDYW5jZWxCdXR0b24oKTsgfSwgY2xhc3M6IFwiaWNvbi1idXR0b25cIiwgdmFyaWFudDogXCJpY29uXCIsIGljb246IFwiYmFuXCIgfSkpO1xuICAgICAgICByZXR1cm4gW3Zpc3VhbGl6YXRpb24sIGNhbmNlbEJ1dHRvbl07XG4gICAgfTtcbiAgICBjbGFzc18xLnByb3RvdHlwZS5mb290ZXJKU1ggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmICh0aGlzLmNoYXRTdGF0ZSA9PT0gQ2hhdFN0YXRlLkxpc3RlbmluZylcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxpc3RlbmluZ0Zvb3RlckpTWCgpO1xuICAgICAgICB2YXIgaW5wdXRQbGFjZWhvbGRlciA9IHRoaXMudGV4dEVuYWJsZWRcbiAgICAgICAgICAgID8gVHJhbnNsYXRpb25zLlRFWFRfSU5QVVRfUExBQ0VIT0xERVJcbiAgICAgICAgICAgIDogVHJhbnNsYXRpb25zLlZPSUNFX0lOUFVUX1BMQUNFSE9MREVSO1xuICAgICAgICB2YXIgdGV4dElucHV0ID0gKGgoXCJhbXBsaWZ5LWlucHV0XCIsIHsgcGxhY2Vob2xkZXI6IEkxOG4uZ2V0KGlucHV0UGxhY2Vob2xkZXIpLCBkZXNjcmlwdGlvbjogXCJ0ZXh0XCIsIGhhbmRsZUlucHV0Q2hhbmdlOiBmdW5jdGlvbiAoZXZ0KSB7IHJldHVybiBfdGhpcy5oYW5kbGVUZXh0Q2hhbmdlKGV2dCk7IH0sIHZhbHVlOiB0aGlzLnRleHQsIGRpc2FibGVkOiB0aGlzLmNoYXRTdGF0ZSA9PT0gQ2hhdFN0YXRlLkVycm9yIHx8ICF0aGlzLnRleHRFbmFibGVkIH0pKTtcbiAgICAgICAgdmFyIG1pY0J1dHRvbiA9IHRoaXMudm9pY2VFbmFibGVkICYmIChoKFwiYW1wbGlmeS1idXR0b25cIiwgeyBcImRhdGEtdGVzdFwiOiBcImNoYXRib3QtbWljLWJ1dHRvblwiLCBoYW5kbGVCdXR0b25DbGljazogZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuaGFuZGxlTWljQnV0dG9uKCk7IH0sIGNsYXNzOiBcImljb24tYnV0dG9uXCIsIHZhcmlhbnQ6IFwiaWNvblwiLCBpY29uOiBcIm1pY3JvcGhvbmVcIiwgZGlzYWJsZWQ6IHRoaXMuY2hhdFN0YXRlID09PSBDaGF0U3RhdGUuRXJyb3IgfHxcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXRTdGF0ZSAhPT0gQ2hhdFN0YXRlLkluaXRpYWwgfSkpO1xuICAgICAgICB2YXIgc2VuZEJ1dHRvbiA9IHRoaXMudGV4dEVuYWJsZWQgJiYgKGgoXCJhbXBsaWZ5LWJ1dHRvblwiLCB7IFwiZGF0YS10ZXN0XCI6IFwiY2hhdGJvdC1zZW5kLWJ1dHRvblwiLCBjbGFzczogXCJpY29uLWJ1dHRvblwiLCB2YXJpYW50OiBcImljb25cIiwgaWNvbjogXCJzZW5kXCIsIGhhbmRsZUJ1dHRvbkNsaWNrOiBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zZW5kVGV4dE1lc3NhZ2UoKTsgfSwgZGlzYWJsZWQ6IHRoaXMuY2hhdFN0YXRlID09PSBDaGF0U3RhdGUuRXJyb3IgfHxcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXRTdGF0ZSAhPT0gQ2hhdFN0YXRlLkluaXRpYWwgfSkpO1xuICAgICAgICByZXR1cm4gW3RleHRJbnB1dCwgbWljQnV0dG9uLCBzZW5kQnV0dG9uXTtcbiAgICB9O1xuICAgIGNsYXNzXzEucHJvdG90eXBlLmVycm9yVG9hc3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmICghdGhpcy5lcnJvcilcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdmFyIF9hID0gdGhpcy5lcnJvciwgbWVzc2FnZSA9IF9hLm1lc3NhZ2UsIGVycm9yVHlwZSA9IF9hLmVycm9yVHlwZTtcbiAgICAgICAgcmV0dXJuIChoKFwiYW1wbGlmeS10b2FzdFwiLCB7IG1lc3NhZ2U6IEkxOG4uZ2V0KG1lc3NhZ2UpLCBoYW5kbGVDbG9zZTogZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuaGFuZGxlVG9hc3RDbG9zZShlcnJvclR5cGUpOyB9IH0pKTtcbiAgICB9O1xuICAgIGNsYXNzXzEucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgcmV0dXJuIChoKEhvc3QsIG51bGwsIGgoXCJkaXZcIiwgeyBjbGFzczogXCJhbXBsaWZ5LWNoYXRib3RcIiB9LCBoKFwic2xvdFwiLCB7IG5hbWU6IFwiaGVhZGVyXCIgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImhlYWRlclwiLCBcImRhdGEtdGVzdFwiOiBcImNoYXRib3QtaGVhZGVyXCIgfSwgSTE4bi5nZXQodGhpcy5ib3RUaXRsZSkpKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImJvZHlcIiwgXCJkYXRhLXRlc3RcIjogXCJjaGF0Ym90LWJvZHlcIiB9LCB0aGlzLm1lc3NhZ2VKU1godGhpcy5tZXNzYWdlcykpLCBoKFwiZm9ybVwiLCB7IG9uU3VibWl0OiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gX3RoaXMuaGFuZGxlU3VibWl0KGUpOyB9IH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJmb290ZXJcIiwgXCJkYXRhLXRlc3RcIjogXCJjaGF0Ym90LWZvb3RlclwiIH0sIHRoaXMuZm9vdGVySlNYKCkpKSwgdGhpcy5lcnJvclRvYXN0KCkpKSk7XG4gICAgfTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoY2xhc3NfMS5wcm90b3R5cGUsIFwiZWxlbWVudFwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfSxcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIHJldHVybiBjbGFzc18xO1xufSgpKTtcbkFtcGxpZnlDaGF0Ym90LnN0eWxlID0gYW1wbGlmeUNoYXRib3RDc3M7XG5leHBvcnQgeyBBbXBsaWZ5Q2hhdGJvdCBhcyBhbXBsaWZ5X2NoYXRib3QgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./node_modules/@aws-amplify/ui-components/dist/esm-es5/amplify-chatbot.entry.js\n"));

/***/ })

}]);